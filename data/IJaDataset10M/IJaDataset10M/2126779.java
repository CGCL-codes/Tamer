package br.jabuti.cmdtool;

import java.io.*;
import br.jabuti.project.*;
import br.jabuti.util.*;

/**

 This application program print a table containing all classes and
 methods under testing in a given testing project.
 
 Example of use:
 	To obtain such a table it is necessary to invoke this application program, 
 	specifying the name of the testing project after the parameter -P. In the
 	example, we are using a project named "test.jtb".
 	
 	$ java -cp ".;lib\BCEL.jar;lib\jviewsall.jar" cmdtool.PrintClassMethodTable -P test.jbt
 	
 	The generated output is a table like this:
 	
	1       samples.Test    0       <init>()V
	1       samples.Test    1       main([Ljava/lang/String;)V
	1       samples.Test    2       testPrint(Ljava/lang/String;)V 
	
	where:
		1 column is the class_id;
		2 second column is the class_name;
		3 column is the method_id, inside a given class;
		4 column is the method name.
		
 
 @version: 0.00001
 @author: Auri Marcelo Rizzo Vincenzi
*/
public class PrintClassMethodTable {

    public static void usage() {
        System.out.println(ToolConstants.toolName + " v. " + ToolConstants.toolVersion);
        System.out.println("\nPrintClassMethodTable usage:");
        System.out.println("-------------------\n");
        System.out.println("java cmdtool.PrintClassMethodTable [-d <DIR>] -p <PROJECT_NAME>\n");
        System.out.println("      [-d <DIR>]              Optional parameter. Specify the directory where the project");
        System.out.println("                              is located. If not specified, the current directory is assumed.");
        System.out.println("      -p <PROJECT_NAME>       Specify the name of the project to be used. The");
        System.out.println("                              project must be a valid project file (.jba) generated by");
        System.out.println("                              instrument the base class.");
        System.out.println("\nCopyright (c) 2002\n");
    }

    public static void main(String args[]) throws Throwable {
        String workDir = null;
        String projectName = null;
        JabutiProject project = null;
        if (args.length > 0) {
            int i = 0;
            while ((i < args.length) && (args[i].startsWith("-"))) {
                if (("-d".equals(args[i])) && (i < args.length - 1)) {
                    i++;
                    workDir = args[i];
                } else if (("-p".equals(args[i])) && (i < args.length - 1)) {
                    i++;
                    projectName = args[i];
                } else {
                    System.out.println("Error: Unrecognized option: " + args[i]);
                    System.exit(0);
                }
                i++;
            }
            if (projectName == null) {
                System.out.println("Error: Missing parameter!!!");
                usage();
                System.exit(0);
            }
            String absoluteName = null;
            if (workDir != null) {
                absoluteName = workDir + File.separator + projectName;
            } else {
                absoluteName = projectName;
            }
            try {
                File theFile = new File(absoluteName);
                if (!theFile.isFile()) {
                    System.out.println("File " + theFile.getName() + " not found");
                    System.exit(0);
                }
                project = JabutiProject.reloadProj(theFile.toString(), true);
                String[] classFileNames = project.getAllClassFileNames();
                for (i = 0; i < classFileNames.length; i++) {
                    ClassFile cf = project.getClassFile(classFileNames[i]);
                    String[] methodsNames = cf.getAllMethodsNames();
                    if (methodsNames != null) {
                        for (int j = 0; j < methodsNames.length; j++) {
                            ClassMethod cm = cf.getMethod(methodsNames[j]);
                            System.out.print(cf.getClassId() + "\t" + classFileNames[i] + "\t");
                            System.out.print(cm.getMethodId() + "\t" + methodsNames[j] + "\n");
                        }
                    }
                }
            } catch (Exception e) {
                ToolConstants.reportException(e, ToolConstants.STDERR);
                System.exit(0);
            }
        } else {
            usage();
        }
    }
}
