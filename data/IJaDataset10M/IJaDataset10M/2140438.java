package org.openbroad.client.admin.view;

import java.net.*;
import org.openbroad.client.admin.view.control.Config;
import org.openbroad.client.stub.*;

/**
 *
 */
public class ServerSettings extends javax.swing.JFrame {

    /** Creates new form ServerSettings */
    public ServerSettings(org.openbroad.client.admin.Main main) {
        this.main = main;
        initComponents();
    }

    /** This method is called from within the constructor to
    * initialize the form.
    * WARNING: Do NOT modify this code. The content of this method is
    * always regenerated by the Form Editor.
    */
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;
        jPanel2 = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jPanel4 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        server = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        username = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        password = new javax.swing.JTextField();
        jPanel1 = new javax.swing.JPanel();
        jButton1 = new javax.swing.JButton();
        setTitle(java.util.ResourceBundle.getBundle("org/openbroad/client/languages/openbroad").getString("preferences"));
        addWindowListener(new java.awt.event.WindowAdapter() {

            public void windowClosing(java.awt.event.WindowEvent evt) {
                exitForm(evt);
            }
        });
        jPanel2.setLayout(new java.awt.BorderLayout());
        jPanel2.setBorder(new javax.swing.border.CompoundBorder(new javax.swing.border.EmptyBorder(new java.awt.Insets(5, 5, 0, 5)), new javax.swing.border.EtchedBorder()));
        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/openbroad/client/ressources/48_network4.png")));
        jPanel3.add(jLabel1);
        jPanel2.add(jPanel3, java.awt.BorderLayout.WEST);
        jPanel4.setLayout(new java.awt.GridBagLayout());
        jLabel2.setText(java.util.ResourceBundle.getBundle("org/openbroad/client/languages/openbroad").getString("servername"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        gridBagConstraints.insets = new java.awt.Insets(3, 3, 3, 3);
        jPanel4.add(jLabel2, gridBagConstraints);
        server.setText(Config.getConfig().getProperty("server"));
        server.setPreferredSize(new java.awt.Dimension(200, 19));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(3, 3, 3, 3);
        jPanel4.add(server, gridBagConstraints);
        jLabel3.setText(java.util.ResourceBundle.getBundle("org/openbroad/client/languages/openbroad").getString("username"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        gridBagConstraints.insets = new java.awt.Insets(3, 3, 3, 3);
        jPanel4.add(jLabel3, gridBagConstraints);
        username.setText(Config.getConfig().getProperty("username"));
        username.setPreferredSize(new java.awt.Dimension(100, 19));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(3, 3, 3, 3);
        jPanel4.add(username, gridBagConstraints);
        jLabel4.setText(java.util.ResourceBundle.getBundle("org/openbroad/client/languages/openbroad").getString("password"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        gridBagConstraints.insets = new java.awt.Insets(3, 3, 3, 3);
        jPanel4.add(jLabel4, gridBagConstraints);
        password.setText(Config.getConfig().getProperty("password"));
        password.setPreferredSize(new java.awt.Dimension(100, 19));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(3, 3, 3, 3);
        jPanel4.add(password, gridBagConstraints);
        jPanel2.add(jPanel4, java.awt.BorderLayout.CENTER);
        getContentPane().add(jPanel2, java.awt.BorderLayout.CENTER);
        jPanel1.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT));
        jButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/openbroad/client/ressources/icons/stock_ok.png")));
        jButton1.setText(java.util.ResourceBundle.getBundle("org/openbroad/client/languages/openbroad").getString("ok"));
        jButton1.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        jPanel1.add(jButton1);
        getContentPane().add(jPanel1, java.awt.BorderLayout.SOUTH);
        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width - 400) / 2, (screenSize.height - 300) / 2, 400, 300);
    }

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {
        if (testServerSettings()) {
            Config.getConfig().setProperty("server", server.getText());
            Config.getConfig().setProperty("username", username.getText());
            Config.getConfig().setProperty("password", password.getText());
            setVisible(false);
            dispose();
            main.doRest();
        }
    }

    /** Exit the Application */
    private void exitForm(java.awt.event.WindowEvent evt) {
    }

    private boolean testServerSettings() {
        server.setEnabled(false);
        username.setEnabled(false);
        password.setEnabled(false);
        boolean testOk = false;
        try {
            URL url = new URL("http://" + server.getText() + ":8080/jboss-net/services/TestService");
            TestServiceRemoteServiceLocator tsrsl = new TestServiceRemoteServiceLocator();
            TestServiceSoapBindingStub tsr = (TestServiceSoapBindingStub) tsrsl.getTestService(url);
            tsr.setUsername(username.getText());
            tsr.setPassword(password.getText());
            tsr.testLoginAdmin();
            testOk = true;
        } catch (MalformedURLException murle) {
        } catch (javax.xml.rpc.ServiceException se) {
        } catch (java.rmi.RemoteException re) {
        }
        server.setEnabled(true);
        username.setEnabled(true);
        password.setEnabled(true);
        return testOk;
    }

    private org.openbroad.client.admin.Main main;

    private javax.swing.JButton jButton1;

    private javax.swing.JLabel jLabel1;

    private javax.swing.JLabel jLabel2;

    private javax.swing.JLabel jLabel3;

    private javax.swing.JLabel jLabel4;

    private javax.swing.JPanel jPanel1;

    private javax.swing.JPanel jPanel2;

    private javax.swing.JPanel jPanel3;

    private javax.swing.JPanel jPanel4;

    private javax.swing.JTextField password;

    private javax.swing.JTextField server;

    private javax.swing.JTextField username;
}
