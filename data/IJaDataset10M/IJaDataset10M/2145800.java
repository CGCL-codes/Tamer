package no.treing.javaee.gui;

import java.rmi.RemoteException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JTabbedPane;
import no.treing.javaee.server.Server;

/**
 *
 * @author  eirikb
 */
public class ChatPanel extends javax.swing.JPanel {

    private Server server;

    private String nick;

    private String to;

    /** Creates new form Chat */
    public ChatPanel(Server server, String nick, String to) {
        this.server = server;
        this.nick = nick;
        this.to = to;
        initComponents();
    }

    public void appendChat(String from, String msg) {
        chatArea.append("<" + from + "> " + msg + "\n");
        setTitle();
    }

    public void appendChat(String msg) {
        chatArea.append(msg + "\n");
        setTitle();
    }

    private void setTitle() {
        JTabbedPane parent = (JTabbedPane) getParent();
        {
            parent.setTitleAt(parent.getComponentZOrder(this), "* " + to);
        }
    }

    private void resetTitle() {
        JTabbedPane parent = (JTabbedPane) getParent();
        if (parent.getSelectedComponent().equals(this)) {
            parent.setTitleAt(parent.getSelectedIndex(), to);
        }
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    private void initComponents() {
        chatField = new javax.swing.JTextField();
        chatPanel = new javax.swing.JPanel();
        chatScrollPane = new javax.swing.JScrollPane();
        chatArea = new javax.swing.JTextArea();
        chatCloseButton = new javax.swing.JButton();
        addComponentListener(new java.awt.event.ComponentAdapter() {

            public void componentShown(java.awt.event.ComponentEvent evt) {
                formComponentShown(evt);
            }
        });
        addFocusListener(new java.awt.event.FocusAdapter() {

            public void focusGained(java.awt.event.FocusEvent evt) {
                formFocusGained(evt);
            }
        });
        setLayout(new java.awt.BorderLayout());
        chatField.addKeyListener(new java.awt.event.KeyAdapter() {

            public void keyPressed(java.awt.event.KeyEvent evt) {
                chatFieldKeyPressed(evt);
            }
        });
        add(chatField, java.awt.BorderLayout.SOUTH);
        chatPanel.setLayout(new java.awt.BorderLayout());
        chatArea.setColumns(20);
        chatArea.setEditable(false);
        chatArea.setRows(5);
        chatScrollPane.setViewportView(chatArea);
        chatPanel.add(chatScrollPane, java.awt.BorderLayout.CENTER);
        add(chatPanel, java.awt.BorderLayout.CENTER);
        chatCloseButton.setText("Lukk vindu");
        chatCloseButton.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chatCloseButtonActionPerformed(evt);
            }
        });
        add(chatCloseButton, java.awt.BorderLayout.PAGE_START);
    }

    private void chatFieldKeyPressed(java.awt.event.KeyEvent evt) {
        if (evt.getKeyCode() == java.awt.event.KeyEvent.VK_ENTER) {
            String msg = chatField.getText();
            chatField.setText("");
            appendChat(nick, msg);
            try {
                server.sendChat(nick, to, msg);
            } catch (RemoteException ex) {
                Logger.getLogger(ChatPanel.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }

    private void chatCloseButtonActionPerformed(java.awt.event.ActionEvent evt) {
        getParent().remove(this);
    }

    private void formFocusGained(java.awt.event.FocusEvent evt) {
    }

    private void formComponentShown(java.awt.event.ComponentEvent evt) {
        resetTitle();
        chatField.requestFocus();
    }

    private javax.swing.JTextArea chatArea;

    private javax.swing.JButton chatCloseButton;

    private javax.swing.JTextField chatField;

    private javax.swing.JPanel chatPanel;

    private javax.swing.JScrollPane chatScrollPane;
}
