package GUI;

import Model.Util.DataBase;
import java.sql.Date;
import javax.swing.JFrame;
import org.jdesktop.application.Action;

/**
 *
 * @author PaO
 */
public class Cheque extends javax.swing.JPanel {

    int banco = 0;

    int consecutivo = 0;

    double importe = 0;

    ErrorDialog error = null;

    ExitoDialog exito = null;

    String beneficiario = null;

    String concepto = null;

    String status = null;

    java.util.Date fecha_d = null;

    java.sql.Date fecha_s = null;

    /** Creates new form Cheque */
    public Cheque() {
        initComponents();
        this.jComboBox11.setEnabled(true);
        fecha_d = new java.util.Date();
        fecha_s = new java.sql.Date(fecha_d.getTime());
        this.jFormattedTextField1.setValue(fecha_s);
    }

    public void resetComp() {
        this.jComboBox1.setSelectedIndex(0);
        this.jFormattedTextField80.setValue(null);
        this.jTextField2.setText("");
        this.jTextField40.setText("");
        fecha_d = new java.util.Date();
        fecha_s = new java.sql.Date(fecha_d.getTime());
        this.jFormattedTextField1.setValue(fecha_s);
        this.jFormattedTextField157.setValue(null);
        this.jCheckBox1.setSelected(false);
        this.jCheckBox1.setEnabled(true);
        this.jComboBox1.setEnabled(true);
    }

    public boolean recuperaValores() {
        this.status = (String) this.jComboBox11.getSelectedItem();
        if ((Number) this.jFormattedTextField157.getValue() != null) this.importe = ((Number) this.jFormattedTextField157.getValue()).doubleValue();
        this.beneficiario = this.jTextField2.getText();
        this.concepto = this.jTextField40.getText();
        if (this.jFormattedTextField1.getValue() != null) {
            this.fecha_d = (java.util.Date) this.jFormattedTextField1.getValue();
            this.fecha_s = new Date(fecha_d.getTime());
        }
        if (importe == 0 || beneficiario.equals("") || concepto.equals("") || this.fecha_s == null) {
            JFrame mainFrame = Regasap.getApplication().getMainFrame();
            error = new ErrorDialog(mainFrame, true);
            error.setErrorText("¡Debe establecer un valor válido para todos los campos!");
            error.setLocationRelativeTo(mainFrame);
            error.setVisible(true);
            return false;
        } else return true;
    }

    public void consultaAsignaConsecutivo() {
        int consecutivo_sig = 0;
        this.banco = this.jComboBox1.getSelectedIndex();
        if (banco == 0) banco = 1; else if (banco == 1) banco = 3; else if (banco == 2) banco = 4;
        consecutivo = DataBase.consultaConsecutivoCheque(banco);
        this.jFormattedTextField80.setValue(consecutivo);
        consecutivo_sig = consecutivo + 1;
        DataBase.insertaConsecutivoCheque(consecutivo_sig, banco);
        this.jComboBox1.setEnabled(false);
    }

    @Action
    public void guardar() {
        boolean verifica = false;
        int insercion = 0;
        verifica = this.recuperaValores();
        if (verifica) {
            JFrame mainFrame = Regasap.getApplication().getMainFrame();
            insercion = DataBase.insertaCheque(RegasapView.usuario, fecha_s, beneficiario, concepto, importe, banco, consecutivo, status);
            if (insercion <= 0) {
                error = new ErrorDialog(mainFrame, true);
                error.setErrorText("!Hubo un error interno mientras se registraba el cheque!");
                error.setLocationRelativeTo(this);
                error.setVisible(true);
            } else {
                exito = new ExitoDialog(mainFrame, true);
                exito.setExitoText("!El cheque se registró correctamente en el sistema!");
                exito.setLocationRelativeTo(this);
                exito.setVisible(true);
                this.resetComp();
            }
        }
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    private void initComponents() {
        jPanel1 = new javax.swing.JPanel();
        chequePn = new javax.swing.JPanel();
        jLabel399 = new javax.swing.JLabel();
        jFormattedTextField80 = new javax.swing.JFormattedTextField();
        jLabel400 = new javax.swing.JLabel();
        jLabel401 = new javax.swing.JLabel();
        jTextField2 = new javax.swing.JTextField();
        jLabel402 = new javax.swing.JLabel();
        jFormattedTextField157 = new javax.swing.JFormattedTextField();
        jTextField40 = new javax.swing.JTextField();
        jLabel403 = new javax.swing.JLabel();
        jLabel405 = new javax.swing.JLabel();
        jComboBox1 = new javax.swing.JComboBox();
        jSeparator1 = new javax.swing.JSeparator();
        jButton1 = new javax.swing.JButton();
        jFormattedTextField1 = new javax.swing.JFormattedTextField();
        jLabel16 = new javax.swing.JLabel();
        jComboBox11 = new javax.swing.JComboBox();
        jCheckBox1 = new javax.swing.JCheckBox();
        setName("Form");
        jPanel1.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        jPanel1.setName("jPanel1");
        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(GUI.Regasap.class).getContext().getResourceMap(Cheque.class);
        chequePn.setBorder(javax.swing.BorderFactory.createTitledBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 1, true), resourceMap.getString("chequePn.border.title"), javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION, resourceMap.getFont("chequePn.border.titleFont")));
        chequePn.setName("chequePn");
        jLabel399.setFont(resourceMap.getFont("jLabel405.font"));
        jLabel399.setText(resourceMap.getString("jLabel399.text"));
        jLabel399.setName("jLabel399");
        jFormattedTextField80.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("###0"))));
        jFormattedTextField80.setEnabled(false);
        jFormattedTextField80.setName("jFormattedTextField80");
        jLabel400.setFont(resourceMap.getFont("jLabel400.font"));
        jLabel400.setText(resourceMap.getString("jLabel400.text"));
        jLabel400.setName("jLabel400");
        jLabel401.setFont(resourceMap.getFont("jLabel401.font"));
        jLabel401.setText(resourceMap.getString("jLabel401.text"));
        jLabel401.setName("jLabel401");
        jTextField2.setName("jTextField2");
        jLabel402.setFont(resourceMap.getFont("jLabel400.font"));
        jLabel402.setText(resourceMap.getString("jLabel402.text"));
        jLabel402.setName("jLabel402");
        jFormattedTextField157.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#,##0.00"))));
        jFormattedTextField157.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        jFormattedTextField157.setName("jFormattedTextField157");
        jTextField40.setName("jTextField40");
        jLabel403.setFont(resourceMap.getFont("jLabel400.font"));
        jLabel403.setText(resourceMap.getString("jLabel403.text"));
        jLabel403.setName("jLabel403");
        jLabel405.setFont(resourceMap.getFont("jLabel405.font"));
        jLabel405.setText(resourceMap.getString("jLabel405.text"));
        jLabel405.setName("jLabel405");
        jComboBox1.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "BBVA Bancomer", "HSBC", "IXE" }));
        jComboBox1.setName("jComboBox1");
        jComboBox1.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox1ActionPerformed(evt);
            }
        });
        jSeparator1.setName("jSeparator1");
        javax.swing.ActionMap actionMap = org.jdesktop.application.Application.getInstance(GUI.Regasap.class).getContext().getActionMap(Cheque.class, this);
        jButton1.setAction(actionMap.get("guardar"));
        jButton1.setFont(resourceMap.getFont("jButton1.font"));
        jButton1.setText(resourceMap.getString("jButton1.text"));
        jButton1.setName("jButton1");
        jFormattedTextField1.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.DateFormatter(new java.text.SimpleDateFormat("dd/MM/yyyy"))));
        jFormattedTextField1.setName("jFormattedTextField1");
        jLabel16.setFont(resourceMap.getFont("jLabel16.font"));
        jLabel16.setText(resourceMap.getString("jLabel16.text"));
        jLabel16.setName("jLabel16");
        jComboBox11.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Activo", "Cancelado" }));
        jComboBox11.setName("jComboBox11");
        jCheckBox1.setFont(resourceMap.getFont("jCheckBox1.font"));
        jCheckBox1.setText(resourceMap.getString("jCheckBox1.text"));
        jCheckBox1.setName("jCheckBox1");
        jCheckBox1.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox1ActionPerformed(evt);
            }
        });
        javax.swing.GroupLayout chequePnLayout = new javax.swing.GroupLayout(chequePn);
        chequePn.setLayout(chequePnLayout);
        chequePnLayout.setHorizontalGroup(chequePnLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(jSeparator1, javax.swing.GroupLayout.DEFAULT_SIZE, 744, Short.MAX_VALUE).addGroup(chequePnLayout.createSequentialGroup().addContainerGap().addComponent(jLabel400).addGap(18, 18, 18).addComponent(jFormattedTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, 88, javax.swing.GroupLayout.PREFERRED_SIZE).addGap(18, 18, 18).addComponent(jLabel405).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addGap(18, 18, 18).addComponent(jCheckBox1, javax.swing.GroupLayout.PREFERRED_SIZE, 41, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 24, Short.MAX_VALUE).addComponent(jLabel399).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jFormattedTextField80, javax.swing.GroupLayout.PREFERRED_SIZE, 82, javax.swing.GroupLayout.PREFERRED_SIZE).addGap(24, 24, 24).addComponent(jLabel16).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jComboBox11, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addContainerGap()).addGroup(chequePnLayout.createSequentialGroup().addContainerGap().addComponent(jLabel403, javax.swing.GroupLayout.PREFERRED_SIZE, 77, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField40, javax.swing.GroupLayout.DEFAULT_SIZE, 643, Short.MAX_VALUE).addContainerGap()).addGroup(javax.swing.GroupLayout.Alignment.TRAILING, chequePnLayout.createSequentialGroup().addGap(595, 595, 595).addComponent(jButton1)).addGroup(chequePnLayout.createSequentialGroup().addContainerGap().addComponent(jLabel401).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED).addComponent(jTextField2, javax.swing.GroupLayout.DEFAULT_SIZE, 459, Short.MAX_VALUE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED).addComponent(jLabel402).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED).addComponent(jFormattedTextField157, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE).addContainerGap()));
        chequePnLayout.setVerticalGroup(chequePnLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(chequePnLayout.createSequentialGroup().addGap(14, 14, 14).addGroup(chequePnLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jLabel400).addComponent(jFormattedTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel405).addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel16).addComponent(jComboBox11, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jCheckBox1).addComponent(jLabel399).addComponent(jFormattedTextField80, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)).addGap(12, 12, 12).addGroup(chequePnLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jTextField2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel401).addComponent(jFormattedTextField157, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel402)).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED).addGroup(chequePnLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jLabel403).addComponent(jTextField40, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE).addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jButton1)));
        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(chequePn, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE));
        jPanel1Layout.setVerticalGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(chequePn, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE));
        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE));
        layout.setVerticalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE));
    }

    private void jComboBox1ActionPerformed(java.awt.event.ActionEvent evt) {
    }

    private void jCheckBox1ActionPerformed(java.awt.event.ActionEvent evt) {
        if (this.jCheckBox1.isSelected()) {
            consultaAsignaConsecutivo();
            this.jCheckBox1.setEnabled(false);
        }
    }

    private javax.swing.JPanel chequePn;

    private javax.swing.JButton jButton1;

    private javax.swing.JCheckBox jCheckBox1;

    private javax.swing.JComboBox jComboBox1;

    private javax.swing.JComboBox jComboBox11;

    private javax.swing.JFormattedTextField jFormattedTextField1;

    private javax.swing.JFormattedTextField jFormattedTextField157;

    private javax.swing.JFormattedTextField jFormattedTextField80;

    private javax.swing.JLabel jLabel16;

    private javax.swing.JLabel jLabel399;

    private javax.swing.JLabel jLabel400;

    private javax.swing.JLabel jLabel401;

    private javax.swing.JLabel jLabel402;

    private javax.swing.JLabel jLabel403;

    private javax.swing.JLabel jLabel405;

    private javax.swing.JPanel jPanel1;

    private javax.swing.JSeparator jSeparator1;

    private javax.swing.JTextField jTextField2;

    private javax.swing.JTextField jTextField40;
}
