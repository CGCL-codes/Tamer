package playground.yu.test;

import java.io.IOException;
import net.opengis.kml._2.BoundaryType;
import net.opengis.kml._2.DocumentType;
import net.opengis.kml._2.FolderType;
import net.opengis.kml._2.KmlType;
import net.opengis.kml._2.LinearRingType;
import net.opengis.kml._2.ObjectFactory;
import net.opengis.kml._2.PlacemarkType;
import net.opengis.kml._2.PointType;
import net.opengis.kml._2.PolygonType;
import net.opengis.kml._2.ScreenOverlayType;
import org.apache.log4j.Logger;
import org.matsim.api.basic.v01.Coord;
import org.matsim.core.api.ScenarioLoader;
import org.matsim.core.api.network.Link;
import org.matsim.core.config.Config;
import org.matsim.core.config.MatsimConfigReader;
import org.matsim.core.gbl.Gbl;
import org.matsim.core.network.KmlNetworkWriter;
import org.matsim.core.network.NetworkLayer;
import org.matsim.core.utils.geometry.CoordImpl;
import org.matsim.core.utils.geometry.CoordinateTransformation;
import org.matsim.core.utils.geometry.geotools.MGC;
import org.matsim.core.utils.geometry.transformations.TransformationFactory;
import org.matsim.roadpricing.RoadPricingScheme;
import org.matsim.roadpricing.RoadPricingWriterXMLv1;
import org.matsim.vis.kml.KMZWriter;
import org.matsim.vis.kml.MatsimKMLLogo;
import playground.dgrether.analysis.gis.ShapeFileNetworkWriter;
import playground.dgrether.analysis.gis.ShapeFilePolygonWriter;
import com.vividsolutions.jts.geom.Coordinate;
import com.vividsolutions.jts.geom.CoordinateSequence;
import com.vividsolutions.jts.geom.GeometryFactory;
import com.vividsolutions.jts.geom.LinearRing;
import com.vividsolutions.jts.geom.Point;
import com.vividsolutions.jts.geom.Polygon;
import com.vividsolutions.jts.geom.impl.CoordinateArraySequence;

/**
 * it's only a copy of Grether's
 * codes:playground.dgrether.roadpricing.TollSchemeGenerator
 * 
 * @author dgrether
 * 
 */
public class TollSchemeGenerator {

    private static final Logger log = Logger.getLogger(TollSchemeGenerator.class);

    private static final String TOTAL_BERLIN_CONF = "../matsimTests/tollBerlin/newOSM/config.xml";

    private static final String TOTAL_BERLIN_OUTSCHEME = "../matsimTests/tollBerlin/newOSM/tollTotalBerlin.xml";

    private static final String TOTAL_BERLIN_OUTBASE = "../matsimTests/tollBerlin/newOSM/tollTotalBerlin";

    private static final String TOTAL_BERLIN_GISOUTBASE = "../matsimTests/tollBerlin/newOSM/tollTotalBerlin";

    private static final String googleEarthPolyCoordsTotalBerlin = "13.17113883466226,52.39770518218921,0 13.17161204545781,52.39572636507854,0 13.16872718683225,52.39449023485015,0 13.15928896312155,52.39398273275504,0 " + "13.15275268202292,52.39485704772802,0 13.14599416017625,52.3956250829469,0 13.14365617159489,52.39625732561315,0 13.14309036978183,52.39659977744228,0 13.14321481741771,52.39725841235832,0 13.141935082765,52.39700143599725,0 " + "13.13869569239257,52.39543942805648,0 13.13432034343869,52.39311954463799,0 13.13063422621865,52.3903964444096,0 13.13294899600522,52.38884274012158,0 13.1341639132617,52.38880006984213,0 13.13334624891587,52.38734290692376,0 " + "13.13202095337897,52.38744721877075,0 13.13164565111213,52.38743283669785,0 13.13129381498226,52.38720265064315,0 13.12700088573375,52.38955238334141,0 13.12749989988913,52.39155696517216,0 13.1294367331363,52.39178958790772,0 " + "13.13108798863867,52.39175302609636,0 13.12981701726986,52.39072942631705,0 13.13036922291683,52.39039472780657,0 13.13192497107223,52.39187816596864,0 13.13416625557498,52.39340977649798,0 13.13872690948332,52.39594496590311,0 " + "13.13850371435509,52.39596389090443,0 13.13859748494826,52.39608338308612,0 13.13572674541323,52.39616843792198,0 13.13518533837279,52.39737524823664,0 13.13802340828173,52.39767041726708,0 13.13814005359162,52.39784310772389,0 " + "13.13641274300272,52.39821318868819,0 13.13483044823143,52.39866418551291,0 13.13385803422394,52.39925831796082,0 13.13279762690009,52.3985814674848,0 13.12795455714234,52.39656836807431,0 13.12716408617535,52.39641022899941,0 " + "13.12588296916923,52.39653498495275,0 13.12485842256893,52.39684484171405,0 13.12085854877557,52.39916287493468,0 13.11847588408624,52.40122606210818,0 13.11801437579738,52.40188109546875,0 13.11610792517581,52.40228495296874,0 " + "13.11168572421124,52.40394676815474,0 13.11117469781829,52.40446163031746,0 13.11125588232993,52.40512570080219,0 13.10964644607584,52.40646239907093,0 13.10837959460197,52.40719731098616,0 13.10941054004541,52.40804688168926,0 " + "13.10866637972061,52.40842111660608,0 13.10665298902356,52.4087286949614,0 13.1070506927616,52.4094212477155,0 13.10867244372938,52.40922996811619,0 13.1103580730818,52.40941440454603,0 13.11073734557385,52.4095446302941,0 " + "13.11055956725659,52.41030709065809,0 13.11182283858939,52.41046340664327,0 13.11153370460389,52.41140235585476,0 13.11020898794824,52.41132571916087,0 13.10979065706621,52.41277885051446,0 13.10771172894258,52.41330896829881,0 " + "13.10709835051893,52.41325014152417,0 13.10723304205749,52.41183081248519,0 13.10693809595632,52.40988643622998,0 13.10672742354163,52.40969215380513,0 13.10617435309515,52.4096137303302,0 13.10517095425767,52.40987075017821,0 " + "13.10478573712302,52.40974116183205,0 13.1010815486818,52.41054721772505,0 13.10105040555966,52.41198727581488,0 13.10066072501399,52.41342898978071,0 13.10087318323203,52.41368931039992,0 13.10056663621512,52.41377275359584,0 " + "13.09745214515942,52.41311453260436,0 13.09652997648504,52.41305535015388,0 13.09659749579147,52.41259169542536,0 13.0979994959921,52.41118946505699,0 13.09798915176243,52.40981934861635,0 13.09725946220703,52.40942144292876,0 " + "13.09322375631128,52.41060147998907,0 13.09192032940076,52.4113066669434,0 13.09074176881284,52.41155414851615,0 13.09030489798588,52.41238082760579,0 13.0903156863545,52.41349392811842,0 13.08832074601376,52.41943886456751,0 " + "13.09576751540477,52.42176248846266,0 13.09790617137475,52.42338814931124,0 13.09837725392943,52.4246384122631,0 13.09945928397472,52.42522640016457,0 13.10011506847934,52.4252891479001,0 13.10087584979712,52.42510680563876,0 " + "13.10159020516204,52.42467816936498,0 13.10348711137119,52.42425058357606,0 13.10489983410249,52.42389897703722,0 13.10573204480681,52.42518177826536,0 13.1068990077914,52.4254791471651,0 13.10872148173688,52.42690303600379,0 " + "13.11743547075304,52.43620028542324,0 13.12367718187877,52.43987190897211,0 13.12449194654521,52.44064991209069,0 13.11944720476418,52.44443560381345,0 13.11820124472415,52.44518748038619,0 13.11773832400072,52.44500479186532,0 " + "13.11677376325362,52.44576218230703,0 13.1155383283024,52.44572283950022,0 13.11381636940987,52.44712027713751,0 13.11522350715159,52.44777127288285,0 13.11463668292944,52.44809073550633,0 13.11262004209114,52.44870063292741,0 " + "13.11160235200907,52.44967257520179,0 13.10938799450493,52.45072189470755,0 13.11203215944288,52.45407546981512,0 13.1125771678269,52.45789530240393,0 13.11235543801117,52.45908285861504,0 13.11050584283154,52.46013803528204,0 " + "13.11138716206245,52.46206739161974,0 13.11126516017336,52.46380267586013,0 13.11058178419561,52.46591513180668,0 13.11182692326213,52.46768726163984,0 13.11386803252613,52.46872495515718,0 13.11370170596591,52.4699133293058,0 " + "13.11603352752007,52.47175624988878,0 13.117824310079,52.4746892876431,0 13.11782448025375,52.47732712402343,0 13.1264133862156,52.47864258285128,0 13.1495019628694,52.49630152007772,0 13.1684268865814,52.50919949589056,0 " + "13.15825052029808,52.51293823064313,0 13.14780662765725,52.51706706106444,0 13.14567670698139,52.51730180589687,0 13.14493868442437,52.51800517529125,0 13.14447430390091,52.51887668083874,0 13.14285969345795,52.51973418111902,0 " + "13.13173501336473,52.51806622582354,0 13.12680831107713,52.51763596865921,0 13.1175672611658,52.51718001152288,0 13.1188515176547,52.52180084108937,0 13.11866991774608,52.52337821391922,0 13.11932780636579,52.52899366098394,0 " + "13.12017479183097,52.53197068871865,0 13.123705497456,52.53742796675285,0 13.12587182928626,52.54345215841889,0 13.12506541555968,52.54403595241531,0 13.1306075942541,52.55576202654261,0 13.13640555666186,52.55274935790167,0 " + "13.14363562927948,52.55208365375391,0 13.14731317279102,52.5546300795323,0 13.14614528706629,52.56028199335494,0 13.14701860856567,52.56160883576049,0 13.14775481991595,52.56469831787706,0 13.1501166991718,52.56713364959838,0 " + "13.15139415026101,52.57002517722129,0 13.15331933130823,52.5733126793148,0 13.15361414370693,52.57790762725114,0 13.15001743387904,52.58308639811668,0 13.14370158307553,52.5816412558009,0 13.13899103293346,52.58054068618334,0 " + "13.13752416095809,52.58061442392336,0 13.13637513833498,52.58026157742599,0 13.13265746208168,52.57978778654648,0 13.13194962271046,52.58013638439428,0 13.13071821037842,52.58293240158076,0 13.13007839701637,52.58324192121281,0 " + "13.12809658801792,52.58319832416807,0 13.12932478934512,52.5859064602359,0 13.12851359860136,52.58601262277011,0 13.12866385578478,52.58723834388939,0 13.12961111778725,52.5875289149728,0 13.13119712877857,52.58688394293219,0 " + "13.13271975131121,52.58687550913005,0 13.1355844906039,52.58733874270155,0 13.13599685773556,52.58748367734272,0 13.13804889408608,52.58872015273968,0 13.13944652424211,52.5890538500107,0 13.14347089386325,52.58960994973855,0 " + "13.14914420861528,52.59176622536793,0 13.15202090719419,52.59397730430722,0 13.15466926742366,52.59664685247128,0 13.15552666635756,52.59714636850198,0 13.15720716209476,52.59762457311596,0 13.16452268751984,52.59882948690779,0 " + "13.16760624172371,52.59721624957449,0 13.17029570361414,52.59670547125784,0 13.17234545275892,52.59615237680109,0 13.1738309070441,52.59532015027373,0 13.17595153918425,52.59500230972487,0 13.17810609062245,52.59492102973329,0 " + "13.1843846207075,52.59341085851964,0 13.18629065873625,52.59232291468744,0 13.18894464684274,52.59157842669244,0 13.19172550206565,52.59022303721356,0 13.19634631080477,52.58964019873622,0 13.19892858034459,52.5889363356376,0 " + "13.19990224562211,52.58893812230583,0 13.20525820559426,52.5869683041238,0 13.20711876030226,52.58655631993863,0 13.21130536146941,52.58603135968548,0 13.21268131937838,52.58606141860082,0 13.21637652437697,52.58576648297812,0 " + "13.21878908094633,52.59071930263396,0 13.2188915712108,52.59155009238707,0 13.21766224423956,52.59320757550618,0 13.21523884689365,52.5949130544203,0 13.21068438762618,52.59718981866924,0 13.20769695866775,52.59937394059175,0 " + "13.20211201944638,52.60407496662818,0 13.20132354794285,52.60521494814139,0 13.20147234756837,52.60711667995233,0 13.2031154914896,52.60768920338248,0 13.20561815274209,52.60831636124346,0 13.20681656199738,52.60935630766495,0 " + "13.21459327562772,52.6188652849559,0 13.21709580184032,52.62039377725498,0 13.22035506498209,52.62491533476632,0 13.22073441182487,52.62813471052428,0 13.22306800086759,52.62813009547566,0 13.22418149278031,52.62833958869166,0 " + "13.22598157871854,52.62813523780605,0 13.22606570755705,52.6277201446744,0 13.23112312260542,52.62726266931627,0 13.24273814927223,52.62831697229939,0 13.24667758908863,52.62739131292121,0 13.24923901844906,52.62760258273484,0 " + "13.25260594808893,52.62744699407092,0 13.25790732738043,52.62773396372469,0 13.26064775170581,52.62773679906921,0 13.2640333857626,52.62707346262714,0 13.26537418351247,52.63484010623236,0 13.26409177891393,52.63722823431962,0 " + "13.26225606905243,52.63939138800043,0 13.26206865909676,52.64077932737996,0 13.27002699227912,52.63973216758964,0 13.27441352503488,52.64029155234414,0 13.27733645706334,52.64029327683238,0 13.28373440909269,52.64113274245518,0 " + "13.28454135371339,52.64792393589931,0 13.28392592900888,52.64866622186406,0 13.28456670739639,52.64839861287662,0 13.28514849831858,52.6525184784383,0 13.28190301452078,52.65267325983667,0 13.28280883293471,52.66072399698575,0 " + "13.28723447442771,52.66002581628254,0 13.2898602174778,52.65989790374184,0 13.2937675396181,52.65935412743845,0 13.29969149526858,52.65935966921715,0 13.30202643648729,52.65923120499129,0 13.30715951946439,52.65963983442251,0 " + "13.30784760078788,52.65883816794911,0 13.3089277695276,52.6582146993114,0 13.3087865452244,52.6580168035814,0 13.31017290191825,52.65738800710963,0 13.30057738707146,52.65342178951623,0 13.30599204686903,52.64709169038216,0 " + "13.30840803800162,52.64383961467313,0 13.3092148171418,52.64391878745813,0 13.3095235466927,52.64275838771928,0 13.30914640018098,52.64261657287921,0 13.3092626247105,52.64191218448949,0 13.30891455534623,52.64180570669675,0 " + "13.30900180622539,52.64145411718594,0 13.30822108681195,52.64073274165664,0 13.30825164208271,52.64025900601897,0 13.30813638129555,52.64010089827725,0 13.30738420452168,52.63997730524918,0 13.3073270686653,52.63967875229132,0 " + "13.30634381828329,52.63950240993316,0 13.30727330491525,52.6376629499114,0 13.30712939558421,52.63741786886438,0 13.30600336326439,52.63725909588726,0 13.30574391804672,52.63708377403589,0 13.30951482298532,52.6324291038156,0 " + "13.30987872887928,52.63104916503319,0 13.30969804611759,52.63101257578461,0 13.31018113123852,52.63064953774326,0 13.30984978069955,52.63052214964252,0 13.30988080042803,52.63015869835874,0 13.31030251321606,52.63006770215236,0 " + "13.30985584652953,52.62946660083705,0 13.30892776971615,52.6291016988757,0 13.30603735995195,52.62858490901719,0 13.30517233528911,52.62824115774669,0 13.30325280001512,52.62777751801159,0 13.30270706831589,52.62750220434705,0 " + "13.30285826786659,52.62740809771918,0 13.30859447835915,52.62802963533088,0 13.31297510023212,52.62824818409869,0 13.31954432644576,52.62670633674885,0 13.32345848271726,52.62648073744008,0 13.32876631050621,52.62547195884017,0 " + "13.33257706564968,52.6240682259414,0 13.33284059612218,52.62425883525995,0 13.33675034396988,52.62272115245504,0 13.33676301319804,52.62282829548211,0 13.337054343601,52.62295816618387,0 13.33823683328589,52.62312109573153,0 " + "13.33843700630695,52.62341245701027,0 13.33858821659392,52.62346614520198,0 13.33916512709054,52.62330390727389,0 13.34018451321693,52.62335881338326,0 13.34009488267344,52.62318276229418,0 13.34063762214119,52.62303754678396,0 " + "13.34130633920637,52.62317522333036,0 13.34233418717209,52.62314312483976,0 13.34295984520218,52.62331508355853,0 13.34325606409605,52.6232621384849,0 13.34350483606356,52.62342570740599,0 13.34349114250155,52.62357687035456,0 " + "13.34413008986779,52.62388377613416,0 13.34684648823057,52.62378110825588,0 13.34697321269969,52.6235512898573,0 13.35066915103155,52.62379425025227,0 13.35062773632827,52.62400607854913,0 13.35138613525647,52.62406749814939,0 " + "13.35173556576347,52.62265893146054,0 13.35204234712959,52.62292404250628,0 13.35221291077289,52.62291584536735,0 13.35237811715579,52.62271670388417,0 13.35271361110681,52.62271246566718,0 13.3529599813907,52.62286593617574,0 " + "13.35286434961732,52.62305671179706,0 13.35323578237018,52.623260292876,0 13.3537627034604,52.62328547365182,0 13.35360494345426,52.6235595862302,0 13.3543877132991,52.62358025130072,0 13.35475449259218,52.62377511597915,0 " + "13.35557007096318,52.62366281963319,0 13.35619605464764,52.62330640122311,0 13.35650817525838,52.6234337185853,0 13.35678251343824,52.62339817619025,0 13.35659327628928,52.62310016849975,0 13.35729340809995,52.62309254478468,0 " + "13.35784336849148,52.62291426271314,0 13.35824191822212,52.62319623852673,0 13.35869225692514,52.62310527023227,0 13.35877066243157,52.62333527227015,0 13.35937787521031,52.62322448962959,0 13.35938428918586,52.62332360034971,0 " + "13.35924023169209,52.62365257697861,0 13.35990140453558,52.62423291249603,0 13.36024008746093,52.62420465484502,0 13.36045448440602,52.62402574858994,0 13.36059796415798,52.62419627708334,0 13.36095531104462,52.62423147138156,0 " + "13.36140092566559,52.62447560967882,0 13.36156645025932,52.62425480003231,0 13.36206462100112,52.62421281311472,0 13.36253448651807,52.62451712745623,0 13.36279181193019,52.62453952158815,0 13.36283784469779,52.62474558106862,0 " + "13.36299376029918,52.62477933772901,0 13.36385916701796,52.62486800609396,0 13.36426799521416,52.62457526810643,0 13.36454109952219,52.62474111616622,0 13.36449303412585,52.62499284462469,0 13.36480913564259,52.624993897099,0 " + "13.36466190294841,52.62533363538033,0 13.36526176087322,52.62541695828124,0 13.36545097696166,52.62564527662754,0 13.36596466405398,52.62553056753198,0 13.36638425005855,52.6256875742054,0 13.36697721541308,52.62548741687311,0 " + "13.36712797897869,52.62563156591939,0 13.36781806049708,52.62579063510957,0 13.3688859522647,52.62569537176376,0 13.36891800909503,52.62592413505347,0 13.37007458901636,52.62677662906734,0 13.36996203743295,52.62690949989484,0 " + "13.3707396432609,52.62740239561462,0 13.37083263889855,52.62730331026922,0 13.37105392000667,52.62738126232484,0 13.37158619475204,52.62722381814211,0 13.37179434111453,52.6272302228158,0 13.3719235741804,52.62747828696472,0 " + "13.37348097712005,52.62764475581373,0 13.37339258187377,52.62787105268271,0 13.37381555837495,52.6280409358171,0 13.37417473003081,52.62792192652499,0 13.37424378614096,52.6281709627099,0 13.37442632804064,52.62822881423623,0 " + "13.3747765137586,52.62815252263855,0 13.37487845800984,52.62839722123119,0 13.37511709298894,52.62845525501751,0 13.37526018376972,52.62868215657625,0 13.37564278452088,52.62886619459841,0 13.37603051797878,52.62865844372046,0 " + "13.37575222086239,52.62849463616466,0 13.37598830488486,52.62834162564322,0 13.37660383863364,52.62849099535592,0 13.37662275826739,52.62872610479123,0 13.37642074490486,52.62896253890141,0 13.37664935778027,52.62896227355235,0 " + "13.37681721499078,52.62916991864113,0 13.37705391638606,52.62925633145815,0 13.37693168335311,52.63071401032591,0 13.37624852105815,52.63150771532154,0 13.3780969535295,52.63336560295197,0 13.37794746125542,52.63356161985841,0 " + "13.37875601042286,52.63442275551527,0 13.37960881631742,52.63389999695015,0 13.3805538167065,52.63424849061201,0 13.38065494846069,52.6344516099711,0 13.38191421383817,52.63463480468234,0 13.38305804416018,52.63506042973772,0 " + "13.38215243565002,52.63614218446029,0 13.38224662098443,52.63635424615097,0 13.38324770664306,52.63658201778277,0 13.38362035455365,52.63648397713408,0 13.38375153462168,52.63627163563113,0 13.38465995067114,52.63630553598504,0 " + "13.38474627902921,52.63637849698812,0 13.38448489121771,52.63653197147465,0 13.38458053902197,52.63666607260841,0 13.38521097780752,52.63661886326464,0 13.38546235172229,52.63687569093175,0 13.38657430988697,52.63700194818307,0 " + "13.3872568063517,52.63739684865153,0 13.38803105525335,52.63729480139818,0 13.38842768453706,52.63770480508765,0 13.38897133273003,52.63789598685572,0 13.38874349716082,52.63816129373511,0 13.389712946126,52.63870400611347,0 " + "13.38951319698443,52.63890903100918,0 13.38981188048732,52.63914399538066,0 13.38950625863694,52.63925390628617,0 13.3894525309724,52.63950437426855,0 13.39000439704762,52.63989484039411,0 13.38981143224408,52.64001195385054,0 " + "13.38990254853371,52.64022367403597,0 13.39030414021706,52.64006714424896,0 13.39044871883638,52.64023943992242,0 13.39026730557577,52.64060477563297,0 13.39083295440582,52.64087872335803,0 13.3907171592175,52.64107345948763,0 " + "13.39042878642806,52.64115470033365,0 13.39041971701236,52.64132982188497,0 13.39069079961005,52.64141911890126,0 13.39001621708217,52.641696937524,0 13.39003632596986,52.64187682692784,0 13.39023502484654,52.64193921341201,0 " + "13.39009703711458,52.64208787852956,0 13.39013227774449,52.64223020768036,0 13.39061644086405,52.64272802893506,0 13.39095497587275,52.64265712917736,0 13.39079235231525,52.64282252086941,0 13.3910113729248,52.6432033789588,0 " + "13.39188127098385,52.64321392034389,0 13.39193072062255,52.6435721355983,0 13.39213955736851,52.64383244394379,0 13.39190930444006,52.64398205645957,0 13.39220852961264,52.64465268379639,0 13.39256536054193,52.6445998838341,0 " + "13.39303495321847,52.64525287735798,0 13.39282389883258,52.64539487925727,0 13.39393262610997,52.64641745824886,0 13.39382104104352,52.64674167151776,0 13.39474428787755,52.64745495027132,0 13.39677050059318,52.64746505927617,0 " + "13.39774035268785,52.64822602667201,0 13.39797438356371,52.64824485698296,0 13.40249046362796,52.64528183380019,0 13.40635298007808,52.64361422779397,0 13.4077850620832,52.64259045823174,0 13.40799089297198,52.64268394451216,0 " + "13.41230942287004,52.64338306458121,0 13.41340416891224,52.64265062731576,0 13.41483504718923,52.64235064804672,0 13.41491270448156,52.64164037490515,0 13.41445419744996,52.64106869906398,0 13.41661396154898,52.63936259258632,0 " + "13.42471313766579,52.63558465743027,0 13.42638073692054,52.63663199853904,0 13.42699931754104,52.63665367364453,0 13.42719345654778,52.63701797018977,0 13.42850953593517,52.6374987856924,0 13.4326145889768,52.63733808845414,0 " + "13.43437475604919,52.63813059457799,0 13.43426750615635,52.63850888380257,0 13.43373064497867,52.63886087729114,0 13.43396707138273,52.63896522939167,0 13.4337955130306,52.63935620238765,0 13.43323912628195,52.64137396386892,0 " + "13.43373756382407,52.64415082636819,0 13.43425967489303,52.64446742547467,0 13.43965264612402,52.64539529755974,0 13.44086922786548,52.64919044123332,0 13.44149543253019,52.64931724040764,0 13.44174050107832,52.64908665277773,0 " + "13.44250723917681,52.64910867608892,0 13.44358561872867,52.64950921362036,0 13.44529194557898,52.64959408757854,0 13.44713625642499,52.65001570573248,0 13.45058778440993,52.64998435037101,0 13.45187512078087,52.64975302668605,0 " + "13.45216071039343,52.64889104826466,0 13.45973726135375,52.64828050272345,0 13.4621869169297,52.64903962542853,0 13.46314813994988,52.65034248577668,0 13.46678889935673,52.65175209670363,0 13.46964688304028,52.65185829826655,0 " + "13.47162727929237,52.65307623312591,0 13.47397639670303,52.65424225253469,0 13.47416950172728,52.65550674145464,0 13.47393983405921,52.6558817013721,0 13.47322066108802,52.65629589502753,0 13.4628244750469,52.65730326757091,0 " + "13.46229594516668,52.6573852992268,0 13.45408209524395,52.66162299834646,0 13.45056725685321,52.66247702995761,0 13.45354615781166,52.66449142952913,0 13.45416920030917,52.66450542029373,0 13.45955927522893,52.66852175849767,0 " + "13.45927081658926,52.6686989894457,0 13.45951017774178,52.66903611303597,0 13.4658091701057,52.66736645049554,0 13.47519116986838,52.6752538765297,0 13.47889652913746,52.67318119560713,0 13.47651968006679,52.67105255153694,0 " + "13.47493302322986,52.66841309922835,0 13.47582114778987,52.66730298105399,0 13.47601813611692,52.66688304115624,0 13.47809820493595,52.66772134462656,0 13.48815026489688,52.67029501263339,0 13.48834476983709,52.66984506299871,0 " + "13.48765329146881,52.66903494214942,0 13.48528077764629,52.65874210452456,0 13.49217035160628,52.65410130086149,0 13.49646335768736,52.65237500567621,0 13.50019409195518,52.65094188563788,0 13.50343872377594,52.64980493994715,0 " + "13.50562437005254,52.64906608823277,0 13.50828655665677,52.64779080659112,0 13.50720921389229,52.64531627400982,0 13.51006484120047,52.64681989894617,0 13.51265612858034,52.64524742215362,0 13.51662014382853,52.64649415888573,0 " + "13.51905556210467,52.64697363931241,0 13.52041803010476,52.6447264656925,0 13.52284654448924,52.64478819096874,0 13.52204444796407,52.63970335484828,0 13.51775562985633,52.62970078387662,0 13.51019559947004,52.62754338601327,0 " + "13.50583678381203,52.62563968583298,0 13.50546724967871,52.61969374279871,0 13.50346419774328,52.61904280534629,0 13.49848313661955,52.61092238421232,0 13.49656681581759,52.60508090672423,0 13.49894513256853,52.60515066899721,0 " + "13.49846767836444,52.60435732693485,0 13.4997746919757,52.60377824133753,0 13.50794840230405,52.59222602377679,0 13.52337689222214,52.59264936926498,0 13.52752983843206,52.59228490295886,0 13.54713630865478,52.58784165958281,0 " + "13.54699706923471,52.58757848582668,0 13.55038324082022,52.58634394631428,0 13.55560376644901,52.58413693712082,0 13.56059359648675,52.58120443119375,0 13.56434024028676,52.57847046045976,0 13.56666703050961,52.57607372746436,0 " + "13.56849011238224,52.57320304447966,0 13.56921368089582,52.57314487569366,0 13.5690982977346,52.57334360195883,0 13.57175563992817,52.57328346297745,0 13.57498502634617,52.57386212548246,0 13.57700779053575,52.57282339248614,0 " + "13.57790070190282,52.57105080347204,0 13.58142452451147,52.57102998568133,0 13.58333178333808,52.56749594664733,0 13.58303788279388,52.56591868131974,0 13.58298818784586,52.56503570699461,0 13.58388220264529,52.56372599333126,0 " + "13.58448368608229,52.56107322383395,0 13.58443346026227,52.56004651720485,0 13.58493090555476,52.55879239142814,0 13.5864852852319,52.55767664170435,0 13.58773932689453,52.55573694415194,0 13.58791255260123,52.55521722230206,0 " + "13.58775164925928,52.55281369673617,0 13.58713510202075,52.55177568501482,0 13.58700325662068,52.55086927197011,0 13.58613937842202,52.54955157336659,0 13.61745144091721,52.5444111332053,0 13.62003293462467,52.54403701411597,0 " + "13.63330244438684,52.5431193028937,0 13.63542480689404,52.54243771563537,0 13.63703945220685,52.54240431905971,0 13.63749017570721,52.54095568799093,0 13.63421987403249,52.53775660224662,0 13.63187366649584,52.53811795495741,0 " + "13.63046315563775,52.53776361164344,0 13.62905439608625,52.53783772608463,0 13.62776112831986,52.53748301666001,0 13.62506173600646,52.53777362255379,0 13.62577745666208,52.53420514614813,0 13.62486597100485,52.53374589630638,0 " + "13.62583677461231,52.53019930042731,0 13.63219966993167,52.53069405613221,0 13.64053086479731,52.53039934126579,0 13.64423639730393,52.52988714575327,0 13.64742019612757,52.52978695708638,0 13.65675892899051,52.52994625908712,0 " + "13.65787511057435,52.5263932164164,0 13.65863175864822,52.52597617567312,0 13.65547719367177,52.52409326367589,0 13.64620858563288,52.5204742149679,0 13.63584150472752,52.51433884331053,0 13.63003902295175,52.50757083872304,0 " + "13.62723680606618,52.50083421358039,0 13.62408659160341,52.49450132849621,0 13.6259101276433,52.49351895940334,0 13.62977772273969,52.49300826907442,0 13.61489268272228,52.4806544534088,0 13.61355193753407,52.47564156011916,0 " + "13.61652000591994,52.47493745350769,0 13.61147120104354,52.47093043808148,0 13.61518408667731,52.47007987074427,0 13.61707636468601,52.47117547885353,0 13.62118352906459,52.47046147513666,0 13.6212530815973,52.46860054513053,0 " + "13.62199214494505,52.46841359521438,0 13.62191214480214,52.46718246173397,0 13.6213485537369,52.46663608173461,0 13.62269462739943,52.46638269585807,0 13.62336870706504,52.46681575297286,0 13.62281292734861,52.46786493668176,0 " + "13.62289127072132,52.46873110494848,0 13.6252419536548,52.46879659832676,0 13.62460812258232,52.46913928161878,0 13.62522654075279,52.47353157425086,0 13.62612453150297,52.47380299707317,0 13.62745724689325,52.47354604921434,0 " + "13.6284247507307,52.4736114024416,0 13.6292232865341,52.47393268669418,0 13.63117786083499,52.47509191907858,0 13.63720146087995,52.47631955006933,0 13.64345617939171,52.47921871690631,0 13.64520257559052,52.47891797735546,0 " + "13.64756317093604,52.4788465341867,0 13.65254201865964,52.47717551892637,0 13.65273399990501,52.47728882689354,0 13.65505150127461,52.47681689002074,0 13.65614146590173,52.47630856236707,0 13.65866938923065,52.47486501060382,0 " + "13.66281606122063,52.47371124936989,0 13.66718540084185,52.47412913975973,0 13.66761993165274,52.47375555533653,0 13.67006220882394,52.47311162584423,0 13.67875158889216,52.4691108950667,0 13.68012713837108,52.46795639699099,0 " + "13.6833821903811,52.46602987645106,0 13.68676709310665,52.46502339687796,0 13.68978221995616,52.4647858953367,0 13.69569244407381,52.4640837968575,0 13.69719644692557,52.46193674592989,0 13.69744119712082,52.4603272676773,0 " + "13.69755333811449,52.45833396289241,0 13.6988013518631,52.45656803616383,0 13.69853887256774,52.45534215753925,0 13.70456641570411,52.45479082225393,0 13.70559898645505,52.45816055238409,0 13.70560325540611,52.45976924196079,0 " + "13.70372438912968,52.46008119640833,0 13.70249659543327,52.46430005220446,0 13.70087273130267,52.46614335797037,0 13.69937088646302,52.46790839366199,0 13.70088269532308,52.46828777907955,0 13.70188291273617,52.46736567977164,0 " + "13.70651670313588,52.46497736115164,0 13.71151466506088,52.46312204164697,0 13.71529873748891,52.46258178705625,0 13.71993159582583,52.45727746522761,0 13.72921374941484,52.45077520709601,0 13.73335476340733,52.45029045258981,0 " + "13.73439456624454,52.45060345491767,0 13.73568596388287,52.45052141061005,0 13.73658242761278,52.44972985738421,0 13.7437861318969,52.44892631947626,0 13.74534969173057,52.44923643935291,0 13.75226040775462,52.44775715251056,0 " + "13.75351284323897,52.44746768152188,0 13.7547976159279,52.44671929100495,0 13.7549798680411,52.44631162815603,0 13.75542138213657,52.44612607282178,0 13.75620484406636,52.44633351455532,0 13.75646948323862,52.44612869883191,0 " + "13.75421656665779,52.44320008325556,0 13.75706544951165,52.44280746688085,0 13.75539085783105,52.43844640454722,0 13.76084571349547,52.43795072149967,0 13.76094972330426,52.43755084546354,0 13.7598501452844,52.43611794746897,0 " + "13.75449263663802,52.43666144758628,0 13.75619859527689,52.44155093571344,0 13.7504126062022,52.44142040911336,0 13.74365965751971,52.4379222545494,0 13.74288781027364,52.43459674255355,0 13.74312185565669,52.43438345348068,0 " + "13.74277503857953,52.43291317201406,0 13.73832612605467,52.43328848838724,0 13.73811121505544,52.43288495769106,0 13.73278743930421,52.43352635833874,0 13.73117822364529,52.4338380936579,0 13.72887605713802,52.43448950364094,0 " + "13.72684833186177,52.43524287371392,0 13.72423696748244,52.43655771518427,0 13.72358556350592,52.43671051680147,0 13.72306969621425,52.43702486843909,0 13.72299755278782,52.4367046927613,0 13.72606237153231,52.43525976333625,0 " + "13.72988639572397,52.43392137489408,0 13.73220112263232,52.43340468228794,0 13.74006451292617,52.43234025183624,0 13.739362017917,52.42985850646655,0 13.73889825485247,52.42895944944633,0 13.74158887414888,52.4283010570343,0 " + "13.74106948151409,52.42662561833345,0 13.73771206725914,52.42672603561871,0 13.73085256222954,52.42027112515879,0 13.73131194913099,52.41980019415524,0 13.73120235511133,52.41912548061791,0 13.73003966594835,52.41753908297147,0 " + "13.7294280480702,52.4159692151878,0 13.72976866187365,52.41549655316116,0 13.73326070177878,52.41193115365968,0 13.73380621368817,52.41170748811214,0 13.73412918927688,52.41097199903686,0 13.73674968946583,52.40982907514881,0 " + "13.73747297480373,52.40891387828588,0 13.73768815106912,52.40835634155422,0 13.73822995354832,52.40782136662033,0 13.7377114996738,52.40670897159796,0 13.73515145742997,52.40602461717183,0 13.73385563654965,52.40382222611641,0 " + "13.7338445053628,52.40230553653387,0 13.73123722135647,52.40009678166027,0 13.72988671201049,52.39959506354175,0 13.72937189308026,52.4000390893866,0 13.72885164363734,52.39972455879315,0 13.7284850766738,52.39974549513156,0 " + "13.72755373261998,52.40006139942226,0 13.72633877520233,52.39938276909136,0 13.72528080316904,52.39944081253223,0 13.72455440254613,52.39890847259625,0 13.72285397129982,52.39823176890558,0 13.7198656221539,52.39899478728934,0 " + "13.718148743899,52.3988335268439,0 13.71757810767451,52.3991478815875,0 13.71730897261787,52.39947990517584,0 13.71637514759152,52.39966643844725,0 13.71437943105899,52.39895372957074,0 13.71365078874986,52.39818299774817,0 " + "13.7121699432464,52.39772670672123,0 13.71113993606787,52.39721358535914,0 13.71071388827498,52.39664931138059,0 13.70990893916038,52.39628047303315,0 13.7096663223476,52.39629600185555,0 13.7086231229966,52.39551145332261,0 " + "13.70817678716352,52.3953615389858,0 13.70672306386634,52.39527479124076,0 13.70577882930712,52.39499485215055,0 13.70546233554596,52.39469265481978,0 13.70493154830173,52.39452227637933,0 13.70408183628967,52.39370307759118,0 " + "13.70336261229979,52.39354311174437,0 13.70241594835715,52.39356895019979,0 13.70172856310837,52.39329565157449,0 13.70140225810054,52.39306822010759,0 13.70075584577561,52.39204189865311,0 13.70005863834372,52.39144167190638,0 " + "13.69879334098466,52.39078777022609,0 13.69854710866047,52.39073517395058,0 13.69834813592602,52.39092825705829,0 13.69908591291524,52.39170019510073,0 13.69915823419878,52.39186550281373,0 13.69900677191768,52.39208028116332,0 " + "13.69879959543771,52.39222225171503,0 13.69811990915897,52.3921848832946,0 13.69712685904052,52.39189949235075,0 13.69714016210754,52.39071789539521,0 13.69696437484436,52.39038718224221,0 13.69698768759221,52.38999236992132,0 " + "13.69574634130621,52.38913628453319,0 13.69522946916458,52.38907632816599,0 13.69426131725388,52.38806818658101,0 13.69268944145878,52.3870732349665,0 13.69206857060912,52.38637211451145,0 13.68999656864398,52.38516272655082,0 " + "13.68961007265315,52.38504182101132,0 13.68902329864954,52.38510091918747,0 13.68814017111874,52.38555348102168,0 13.68761535140683,52.38521512636847,0 13.68678814990999,52.38527334277569,0 13.68619363444987,52.38399520366686,0 " + "13.68791079830571,52.38315731605035,0 13.68828842118322,52.38312017702803,0 13.68959556452037,52.38342011545503,0 13.694607581143,52.38114784447036,0 13.69835399313072,52.38157835612023,0 13.6988181345226,52.38149674066317,0 " + "13.6971878413295,52.3776038257686,0 13.69928022268008,52.37779145948964,0 13.69986823708878,52.37756086861457,0 13.70024559370362,52.37758442731479,0 13.70055007317184,52.3771997003354,0 13.69991607115739,52.37562190500381,0 " + "13.69912401358714,52.37487548271039,0 13.69530576723189,52.3706191418865,0 13.69348265600668,52.36943962942146,0 13.69304939643846,52.3689844496354,0 13.69299318752531,52.36871818835247,0 13.69334520314874,52.36822591655187,0 " + "13.69324780304642,52.36791778997359,0 13.69197750111881,52.36782042433018,0 13.69141745820981,52.36763831818164,0 13.692328818305,52.36730289602813,0 13.69219106594833,52.36711145881905,0 13.69079051528885,52.36735673209247,0 " + "13.69015653633921,52.36775690691235,0 13.6892271251277,52.36738540323861,0 13.68781782783158,52.36720562127058,0 13.68692001227494,52.36747400146778,0 13.68462164811217,52.36877329567649,0 13.68378637695275,52.36891120854903,0 " + "13.68218181764746,52.36939518335574,0 13.68034078359733,52.36929191633645,0 13.67847100747029,52.36893586784608,0 13.67622764194994,52.36778564595865,0 13.67513014770136,52.36742075470157,0 13.67175996423446,52.36666045905774,0 " + "13.67110308171718,52.36597296578057,0 13.67033601303057,52.36482803846327,0 13.66873064003161,52.36421917971299,0 13.66697450438333,52.36220175498619,0 13.66606855094124,52.35960528195769,0 13.66643358562856,52.35818434471563,0 " + "13.66628416642235,52.35803986583485,0 13.66535420139968,52.35796891615488,0 13.66402703707357,52.35742761384844,0 13.66295445814382,52.35618750241826,0 13.66256397325179,52.35553535352599,0 13.66266221379929,52.35486738163168,0 " + "13.66204376818663,52.35398443294366,0 13.66148474777972,52.35372121592823,0 13.65984931473586,52.35318615233958,0 13.65957042541586,52.35292170942933,0 13.65936810509628,52.35245239610466,0 13.65903668093169,52.35215682330254,0 " + "13.65773741444325,52.35183791151551,0 13.65727854349073,52.35152818766921,0 13.65707223716107,52.34968335565633,0 13.65621426463599,52.34835242662035,0 13.65611040941287,52.34741472278978,0 13.65384717656086,52.34568015229859,0 " + "13.65138112702238,52.34241253727066,0 13.65177780285237,52.34026561029364,0 13.65175552245666,52.33987135447023,0 13.65134595279805,52.33930131428297,0 13.65052679782134,52.33879576216369,0 13.64947780138681,52.33834760260817,0 " + "13.64827585089753,52.33807729157041,0 13.64592374526271,52.33852893404649,0 13.64556239354436,52.33870357298645,0 13.64453732970343,52.33973781091804,0 13.64268713505506,52.33981945842341,0 13.64147192537749,52.34116256456484,0 " + "13.63987775217287,52.34210015478967,0 13.6382159390731,52.34342015614892,0 13.63747664750498,52.34425449490852,0 13.6362896190101,52.34650217874555,0 13.63654366001199,52.34786722156494,0 13.63658878418977,52.35001270891385,0 " + "13.63718625906214,52.35634535348248,0 13.6380224355896,52.35910101233932,0 13.6392616233394,52.36069091580448,0 13.64173546224684,52.36243844096735,0 13.64660139460467,52.36551118919496,0 13.64747402875666,52.3666660794559,0 " + "13.64751310788584,52.36756474176421,0 13.64700561861017,52.36867351277272,0 13.64673919269233,52.37005352547308,0 13.64395593523078,52.37020075535844,0 13.6419698762598,52.37066049879819,0 13.64281414081147,52.37259497512881,0 " + "13.64251569940626,52.37736741504577,0 13.63310720030841,52.3760627267027,0 13.62842134906201,52.38106611769529,0 13.6106914932871,52.37465205070567,0 13.6060983452644,52.37331580512286,0 13.60583490085627,52.37352920213555,0 " + "13.60663379837531,52.37476886485647,0 13.60676976306951,52.37565772262671,0 13.60650984975109,52.37673531986965,0 13.60541443095677,52.37816328099246,0 13.60629761694422,52.37861940477478,0 13.60625689020645,52.37937254791398,0 " + "13.60595173884641,52.38012609753428,0 13.60384520879936,52.38185017319436,0 13.60310094079755,52.38279195424767,0 13.60172930287934,52.3838164309053,0 13.60075750343429,52.38419237972781,0 13.59957379971452,52.38538308928258,0 " + "13.59641142856302,52.3859138438792,0 13.59498486938889,52.38720789914644,0 13.59494795580014,52.38759851109342,0 13.5952581817909,52.38814518426426,0 13.5953388434456,52.38866646348389,0 13.59502049280431,52.38895041861246,0 " + "13.59457135618104,52.3889179440628,0 13.59433633259482,52.3890522875753,0 13.59435391877382,52.38939864912004,0 13.59376794458361,52.38994740136673,0 13.59378826368487,52.39031606321031,0 13.5942701305473,52.392395690266,0 " + "13.59276350301601,52.39371742707942,0 13.58977994416055,52.39303796293058,0 13.5874957645138,52.39234539473782,0 13.58236989456375,52.39124473619509,0 13.57455225381633,52.38999026694591,0 13.5676364022083,52.38858820989222,0 " + "13.56428595894469,52.38812860426631,0 13.56205754087155,52.3881058279314,0 13.53553794078446,52.38890333288155,0 13.5348584366748,52.39072120774799,0 13.53529322526953,52.39347958448445,0 13.53591864214799,52.39502249956447,0 " + "13.53581444983949,52.39524931690312,0 13.53819499847611,52.39993602195589,0 13.53846499970005,52.40067436049299,0 13.53724908368931,52.40002575405209,0 13.53390125328455,52.39893261149833,0 13.52951762863931,52.39721393021299,0 " + "13.52594877229658,52.39893472107762,0 13.51623892568967,52.4019138745057,0 13.51547903228811,52.40153339849488,0 13.51396010280608,52.40107183650041,0 13.50633099060272,52.39984644782903,0 13.49057875933233,52.39785810659732,0 " + "13.48664248765,52.39744665502767,0 13.48372381407706,52.39695165160887,0 13.47991007444884,52.39599397204466,0 13.47914082278217,52.39981878707491,0 13.47781470029887,52.40279085173748,0 13.47756463554164,52.40362875531379,0 " + "13.47681392765925,52.4039343111757,0 13.46786749713069,52.41991982831473,0 13.46379639455315,52.42081897643653,0 13.46032633305287,52.42060975749337,0 13.45676112510878,52.41976867163412,0 13.44600299719043,52.41649043100405,0 " + "13.44563392042792,52.41622107765502,0 13.43221988038533,52.41257896234055,0 13.42796175092022,52.41189218887261,0 13.4219061978925,52.41051744581432,0 13.41870880479975,52.40993512236948,0 13.41845536066035,52.40875680044845,0 " + "13.41863980768099,52.40707060107129,0 13.41922194386387,52.40512700002136,0 13.42696609053742,52.38806746144323,0 13.42740627687899,52.3863696528875,0 13.42740581887774,52.38572807609796,0 13.42091685807241,52.37611199442623,0 " + "13.41278386976026,52.37643462129779,0 13.41290357383211,52.37677749266114,0 13.40968138373689,52.37654612042677,0 13.39835953674366,52.3774959581948,0 13.38854525336224,52.37783881207143,0 13.38810068781267,52.3790893706818,0 " + "13.38822053642278,52.38224005526582,0 13.38722143710097,52.38858022353659,0 13.37794472979964,52.38816331855725,0 13.37055455309546,52.38842274943636,0 13.37216579907206,52.39351633606948,0 13.35989081088399,52.39835541100495,0 " + "13.34289443266971,52.40763934236542,0 13.34326548162693,52.41170772551111,0 13.31399285931649,52.40052374577202,0 13.31194812578366,52.39922630030809,0 13.31143138623589,52.40000171750555,0 13.2960305192792,52.41450284010007,0 " + "13.2966170601156,52.41464553205619,0 13.2970431675974,52.4150362846151,0 13.29721904598177,52.41575579871351,0 13.29674392921313,52.41620324308735,0 13.29344962423016,52.41459632313151,0 13.2802167843719,52.40726205161248,0 " + "13.27632147354193,52.40538004696341,0 13.27494954704872,52.40496515247332,0 13.27285664878968,52.4046262131362,0 13.27221292679629,52.40433047439761,0 13.27060955177212,52.40417371474919,0 13.26624975235785,52.40428898466811,0 " + "13.26331225084592,52.40503738960244,0 13.26101846355723,52.40599630483184,0 13.25829905094937,52.40637070144796,0 13.25696416562639,52.40642672034526,0 13.25282207897118,52.40601181187437,0 13.24974356893483,52.40498993581584,0 " + "13.24927637479606,52.40786402411484,0 13.2488245742995,52.40841572106425,0 13.24902923989659,52.40888885894132,0 13.24908245322465,52.4117497103062,0 13.24713092716692,52.418895075926,0 13.24589942017548,52.42110904587949,0 " + "13.23809393297715,52.42069081780011,0 13.23573829019481,52.42086247616483,0 13.23329089422011,52.42027281419757,0 13.22522255613523,52.4207892718621,0 13.22498174277678,52.42093542601931,0 13.2236856094847,52.42058255300935,0 " + "13.22356722471833,52.42072345408486,0 13.21865515205843,52.41935319870035,0 13.21705130859391,52.41913616433368,0 13.21526004859984,52.41831615663754,0 13.21392028523795,52.4178652066617,0 13.20926231055654,52.41663015918631,0 " + "13.20460963207511,52.41588803692939,0 13.20119558097771,52.41558253027234,0 13.19795501799973,52.4155382412579,0 13.19687179697123,52.41544425286445,0 13.18534941326971,52.41127538039659,0 13.15929935936949,52.4027802170458,0 " + "13.15930989482778,52.39978945493382,0 13.1577183156745,52.39721277999271,0 13.15788570096819,52.39627708596385,0 13.16832969619052,52.39721962077093,0 13.17113883466226,52.39770518218921,0 ";

    private static final double START = 0;

    private static final double STOP = 86400;

    private static final double AMOUNT = 2;

    private Config config;

    private NetworkLayer network;

    private Coord[] usedCoords;

    private String usedConf = TOTAL_BERLIN_CONF;

    private String usedOut = TOTAL_BERLIN_OUTBASE + ".kmz";

    private String usedSchemeOut = TOTAL_BERLIN_OUTSCHEME;

    private String usedGoogleEarthCoords = googleEarthPolyCoordsTotalBerlin;

    private String usedGisOut = TOTAL_BERLIN_GISOUTBASE;

    private double usedStart = START;

    private double usedStop = STOP;

    private double usedAmount = AMOUNT;

    public TollSchemeGenerator() {
        this.config = new Config();
        this.config.addCoreModules();
        Gbl.setConfig(this.config);
        MatsimConfigReader confReader = new MatsimConfigReader(this.config);
        System.out.println("this.usedConf : " + usedConf);
        confReader.readFile(this.usedConf);
        this.usedCoords = parseGoogleEarthCoord(this.config);
        System.out.println("this.config.network() : " + config.network().toString());
        NetworkLayer tollNetwork = this.createTollScheme(this.config);
        writeKml(tollNetwork, this.usedOut);
        writeRoadPricingScheme(this.createRoadPricingScheme(tollNetwork));
        writeShapeFile(tollNetwork, this.usedCoords);
    }

    private void writeShapeFile(NetworkLayer network, Coord[] coords) {
        new ShapeFileNetworkWriter().writeNetwork(network, usedGisOut + "Network.shp");
        new ShapeFilePolygonWriter().writePolygon(coords, usedGisOut + "MoutArea.shp");
    }

    private NetworkLayer createTollScheme(Config config) {
        System.out.println("createTollScheme(config)->config : " + config.toString());
        ScenarioLoader loader = new ScenarioLoader(config);
        this.network = (NetworkLayer) loader.loadScenario().getNetwork();
        System.out.println("network : " + network.toString());
        NetworkLayer net = filterNetwork(this.network, false);
        log.info("Filtered the network, filtered network layer contains " + net.getLinks().size() + " links.");
        System.out.println("Filtered the network, filtered network layer contains " + net.getLinks().size() + " links.");
        return net;
    }

    private void writeRoadPricingScheme(RoadPricingScheme pricingScheme) {
        RoadPricingWriterXMLv1 pricingSchemeWriter = new RoadPricingWriterXMLv1(pricingScheme);
        try {
            pricingSchemeWriter.writeFile(this.usedSchemeOut);
        } catch (IOException e) {
            e.printStackTrace();
        }
        log.info("RoadPricingScheme written to: " + this.usedSchemeOut);
    }

    private RoadPricingScheme createRoadPricingScheme(NetworkLayer tollNetwork) {
        RoadPricingScheme scheme = new RoadPricingScheme(this.network);
        for (Link l : tollNetwork.getLinks().values()) {
            scheme.addLink(l.getId().toString());
        }
        scheme.addCost(this.usedStart, this.usedStop, this.usedAmount);
        return scheme;
    }

    private Coord[] parseGoogleEarthCoord(Config config) {
        String[] coords3d = this.usedGoogleEarthCoords.split(" ");
        String[] singleCoords;
        double x, y;
        CoordinateTransformation transform = TransformationFactory.getCoordinateTransformation(TransformationFactory.WGS84, config.global().getCoordinateSystem());
        Coord c, coord;
        Coord[] ret = new Coord[coords3d.length];
        int i = 0;
        for (String s : coords3d) {
            singleCoords = s.split(",");
            x = Double.parseDouble(singleCoords[0]);
            y = Double.parseDouble(singleCoords[1]);
            c = new CoordImpl(x, y);
            coord = transform.transform(c);
            ret[i] = coord;
            i++;
        }
        return ret;
    }

    private void writeKml(NetworkLayer net, String filename) {
        ObjectFactory kmlObjectFactory = new ObjectFactory();
        KmlType mainKml = kmlObjectFactory.createKmlType();
        DocumentType mainDoc = kmlObjectFactory.createDocumentType();
        mainKml.setAbstractFeatureGroup(kmlObjectFactory.createDocument(mainDoc));
        FolderType mainFolder = kmlObjectFactory.createFolderType();
        mainFolder.setName("Matsim Data");
        mainDoc.getAbstractFeatureGroup().add(kmlObjectFactory.createFolder(mainFolder));
        KMZWriter writer = new KMZWriter(filename);
        try {
            ScreenOverlayType logo = MatsimKMLLogo.writeMatsimKMLLogo(writer);
            mainFolder.getAbstractFeatureGroup().add(kmlObjectFactory.createScreenOverlay(logo));
            CoordinateTransformation transform = TransformationFactory.getCoordinateTransformation(this.config.global().getCoordinateSystem(), TransformationFactory.WGS84);
            KmlNetworkWriter netWriter = new KmlNetworkWriter(net, transform, writer, mainDoc);
            FolderType networkFolder = netWriter.getNetworkFolder();
            mainFolder.getAbstractFeatureGroup().add(kmlObjectFactory.createFolder(networkFolder));
            FolderType polygonFolder = kmlObjectFactory.createFolderType();
            polygonFolder.setName("Mout area");
            PolygonType p = kmlObjectFactory.createPolygonType();
            p.setTessellate(true);
            LinearRingType ring = kmlObjectFactory.createLinearRingType();
            Coord transC;
            for (Coord c : this.usedCoords) {
                transC = transform.transform(c);
                PointType point = kmlObjectFactory.createPointType();
                point.getCoordinates().add(Double.toString(transC.getX()) + "," + Double.toString(transC.getY()) + ",0.0");
            }
            BoundaryType boundary = kmlObjectFactory.createBoundaryType();
            boundary.setLinearRing(ring);
            p.setOuterBoundaryIs(boundary);
            PlacemarkType polyPlace = kmlObjectFactory.createPlacemarkType();
            polyPlace.setName("Mout area polygon");
            polyPlace.setAbstractGeometryGroup(kmlObjectFactory.createPolygon(p));
            polygonFolder.getAbstractFeatureGroup().add(kmlObjectFactory.createPlacemark(polyPlace));
            mainFolder.getAbstractFeatureGroup().add(kmlObjectFactory.createFolder(polygonFolder));
        } catch (IOException e) {
            Gbl.errorMsg("Cannot create kmz or logo cause: " + e.getMessage());
            e.printStackTrace();
        }
        writer.writeMainKml(mainKml);
        writer.close();
        log.info("Network written to kmz!");
    }

    private NetworkLayer filterNetwork(final NetworkLayer net, boolean full) {
        NetworkLayer n = new NetworkLayer();
        GeometryFactory geofac = new GeometryFactory();
        Coordinate[] geoToolCoords = new Coordinate[this.usedCoords.length];
        int i = 0;
        for (Coord c : this.usedCoords) {
            geoToolCoords[i] = new Coordinate(c.getX(), c.getY());
            i++;
        }
        CoordinateSequence coordsequence = new CoordinateArraySequence(geoToolCoords);
        LinearRing shell = new LinearRing(coordsequence, geofac);
        Polygon ppp = new Polygon(shell, new LinearRing[] {}, geofac);
        for (Link l : net.getLinks().values()) {
            Coordinate fromCord = MGC.coord2Coordinate(l.getFromNode().getCoord());
            Coordinate toCord = MGC.coord2Coordinate(l.getToNode().getCoord());
            if (ppp.contains(new Point(new CoordinateArraySequence(new Coordinate[] { fromCord }), geofac)) && ppp.contains(new Point(new CoordinateArraySequence(new Coordinate[] { toCord }), geofac))) {
                n.getLinks().put(l.getId(), l);
            }
        }
        return n;
    }

    /**
	 * @param args
	 */
    public static void main(String[] args) {
        new TollSchemeGenerator();
    }
}
