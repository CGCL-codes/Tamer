package javapoint;

import javapoint.StaticClasses.Utilities;
import java.awt.event.ActionListener;
import java.awt.event.WindowListener;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileOutputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.io.Writer;
import java.util.jar.JarEntry;
import java.util.jar.JarFile;
import java.util.jar.JarOutputStream;
import javapoint.xml.Constants;
import javapoint.xml.SlidesWriter;
import javax.swing.JOptionPane;

/**
 *
 * @author Kyle
 */
public class preferencesDialog extends javax.swing.JDialog implements ActionListener, WindowListener {

    /** A return status code - returned if Cancel button has been pressed */
    public static final int RET_CANCEL = 0;

    /** A return status code - returned if OK button has been pressed */
    public static final int RET_OK = 1;

    /** Creates new form preferencesDialog */
    public preferencesDialog(java.awt.Frame parent, MainFrame mainFrame) {
        super(parent, true);
        this.mainFrame = mainFrame;
        initComponents();
        switch(mainFrame.mainClass.getSkin()) {
            case 0:
                jRadioButton1.setSelected(true);
                break;
            case 1:
                jRadioButton2.setSelected(true);
                break;
            case 2:
                jRadioButton3.setSelected(true);
                break;
            case 3:
                jRadioButton4.setSelected(true);
                break;
            case 4:
                jRadioButton5.setSelected(true);
                break;
            case 5:
                jRadioButton6.setSelected(true);
                break;
            case 6:
                jRadioButton7.setSelected(true);
                break;
        }
    }

    public static void newPreferenceDialog(final MainFrame mainFrame) {
        final preferencesDialog dialog = new preferencesDialog(new javax.swing.JFrame(), mainFrame);
        dialog.setResizable(false);
        dialog.addWindowListener(new java.awt.event.WindowAdapter() {

            @Override
            public void windowClosing(java.awt.event.WindowEvent e) {
                dialog.dispose();
            }
        });
        dialog.setVisible(true);
    }

    /** @return the return status of this dialog - one of RET_OK or RET_CANCEL */
    public int getReturnStatus() {
        return returnStatus;
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    private void initComponents() {
        buttonGroup1 = new javax.swing.ButtonGroup();
        okButton = new javax.swing.JButton();
        cancelButton = new javax.swing.JButton();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        jRadioButton1 = new javax.swing.JRadioButton();
        jRadioButton2 = new javax.swing.JRadioButton();
        jRadioButton3 = new javax.swing.JRadioButton();
        jRadioButton4 = new javax.swing.JRadioButton();
        jRadioButton5 = new javax.swing.JRadioButton();
        jRadioButton6 = new javax.swing.JRadioButton();
        jRadioButton7 = new javax.swing.JRadioButton();
        addWindowListener(this);
        okButton.setText("OK");
        okButton.addActionListener(this);
        cancelButton.setText("Cancel");
        cancelButton.addActionListener(this);
        buttonGroup1.add(jRadioButton1);
        jRadioButton1.setText("Office Blue");
        jRadioButton1.addActionListener(this);
        buttonGroup1.add(jRadioButton2);
        jRadioButton2.setText("Office Black");
        jRadioButton2.addActionListener(this);
        buttonGroup1.add(jRadioButton3);
        jRadioButton3.setText("Office Silver");
        jRadioButton3.addActionListener(this);
        buttonGroup1.add(jRadioButton4);
        jRadioButton4.setText("Business Black");
        jRadioButton4.addActionListener(this);
        buttonGroup1.add(jRadioButton5);
        jRadioButton5.setText("Business Blue");
        jRadioButton5.addActionListener(this);
        buttonGroup1.add(jRadioButton6);
        jRadioButton6.setText("Business");
        jRadioButton6.addActionListener(this);
        buttonGroup1.add(jRadioButton7);
        jRadioButton7.setText("Nebula");
        jRadioButton7.addActionListener(this);
        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(jPanel1Layout.createSequentialGroup().addContainerGap().addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(jRadioButton7).addComponent(jRadioButton1).addComponent(jRadioButton2).addComponent(jRadioButton3).addComponent(jRadioButton4).addComponent(jRadioButton5).addComponent(jRadioButton6)).addContainerGap(256, Short.MAX_VALUE)));
        jPanel1Layout.setVerticalGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(jPanel1Layout.createSequentialGroup().addContainerGap().addComponent(jRadioButton1).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jRadioButton2).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jRadioButton3).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jRadioButton4).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jRadioButton5).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jRadioButton6).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jRadioButton7).addContainerGap(35, Short.MAX_VALUE)));
        jTabbedPane1.addTab("View", jPanel1);
        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(layout.createSequentialGroup().addContainerGap().addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup().addComponent(okButton, javax.swing.GroupLayout.PREFERRED_SIZE, 67, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(cancelButton)).addComponent(jTabbedPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE)).addContainerGap()));
        layout.linkSize(javax.swing.SwingConstants.HORIZONTAL, new java.awt.Component[] { cancelButton, okButton });
        layout.setVerticalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup().addContainerGap().addComponent(jTabbedPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 249, Short.MAX_VALUE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(cancelButton).addComponent(okButton)).addContainerGap()));
        pack();
    }

    public void actionPerformed(java.awt.event.ActionEvent evt) {
        if (evt.getSource() == okButton) {
            preferencesDialog.this.okButtonActionPerformed(evt);
        } else if (evt.getSource() == cancelButton) {
            preferencesDialog.this.cancelButtonActionPerformed(evt);
        } else if (evt.getSource() == jRadioButton2) {
            preferencesDialog.this.jRadioButton2ActionPerformed(evt);
        } else if (evt.getSource() == jRadioButton1) {
            preferencesDialog.this.jRadioButton1ActionPerformed(evt);
        } else if (evt.getSource() == jRadioButton3) {
            preferencesDialog.this.jRadioButton3ActionPerformed(evt);
        } else if (evt.getSource() == jRadioButton4) {
            preferencesDialog.this.jRadioButton4ActionPerformed(evt);
        } else if (evt.getSource() == jRadioButton5) {
            preferencesDialog.this.jRadioButton5ActionPerformed(evt);
        } else if (evt.getSource() == jRadioButton6) {
            preferencesDialog.this.jRadioButton6ActionPerformed(evt);
        } else if (evt.getSource() == jRadioButton7) {
            preferencesDialog.this.jRadioButton7ActionPerformed(evt);
        }
    }

    public void windowActivated(java.awt.event.WindowEvent evt) {
    }

    public void windowClosed(java.awt.event.WindowEvent evt) {
    }

    public void windowClosing(java.awt.event.WindowEvent evt) {
        if (evt.getSource() == preferencesDialog.this) {
            preferencesDialog.this.closeDialog(evt);
        }
    }

    public void windowDeactivated(java.awt.event.WindowEvent evt) {
    }

    public void windowDeiconified(java.awt.event.WindowEvent evt) {
    }

    public void windowIconified(java.awt.event.WindowEvent evt) {
    }

    public void windowOpened(java.awt.event.WindowEvent evt) {
    }

    private void okButtonActionPerformed(java.awt.event.ActionEvent evt) {
        dispose();
    }

    private void saveTo(final File jarFile) {
        try {
            if (jarFile.exists()) {
                final File temporaryJarFile = Utilities.createTemporaryFile("presentation", ".jar", false, null);
                final JarFile existingJarFile = new JarFile(jarFile);
                final JarOutputStream output = new JarOutputStream(new FileOutputStream(temporaryJarFile));
                for (final JarEntry entry : Utilities.toList(existingJarFile.entries())) {
                    if (!entry.getName().startsWith(Constants.JAR_ENTRY_PRESENTATION_PREFIX)) {
                        final InputStream entryStream = existingJarFile.getInputStream(entry);
                        output.putNextEntry(entry);
                        Utilities.write(entryStream, output);
                    }
                }
                new SlidesWriter().write(mainFrame.getSlides(), output);
                existingJarFile.close();
                jarFile.delete();
                if (!temporaryJarFile.renameTo(jarFile)) {
                    throw new RuntimeException("Failed to update " + jarFile);
                }
            } else {
                new SlidesWriter().write(mainFrame.getSlides(), new JarOutputStream(new FileOutputStream(jarFile)));
            }
        } catch (final Exception exception) {
            try {
                Writer output = null;
                String text = exception.toString() + "\n";
                for (java.lang.StackTraceElement el : exception.getStackTrace()) {
                    text += el.toString() + "\n";
                }
                File file = new File("c:\\write.txt");
                output = new BufferedWriter(new FileWriter(file));
                output.write(text);
                output.close();
            } catch (IOException ex) {
                ex.printStackTrace();
            }
        }
    }

    private void cancelButtonActionPerformed(java.awt.event.ActionEvent evt) {
        doClose(RET_CANCEL);
    }

    /** Closes the dialog */
    private void closeDialog(java.awt.event.WindowEvent evt) {
        doClose(RET_CANCEL);
    }

    private void jRadioButton2ActionPerformed(java.awt.event.ActionEvent evt) {
        mainFrame.mainClass.setSkin(1);
    }

    private void jRadioButton1ActionPerformed(java.awt.event.ActionEvent evt) {
        mainFrame.mainClass.setSkin(0);
    }

    private void jRadioButton3ActionPerformed(java.awt.event.ActionEvent evt) {
        mainFrame.mainClass.setSkin(2);
    }

    private void jRadioButton4ActionPerformed(java.awt.event.ActionEvent evt) {
        mainFrame.mainClass.setSkin(3);
    }

    private void jRadioButton5ActionPerformed(java.awt.event.ActionEvent evt) {
        mainFrame.mainClass.setSkin(4);
    }

    private void jRadioButton6ActionPerformed(java.awt.event.ActionEvent evt) {
        mainFrame.mainClass.setSkin(5);
    }

    private void jRadioButton7ActionPerformed(java.awt.event.ActionEvent evt) {
        mainFrame.mainClass.setSkin(6);
    }

    private void doClose(int retStatus) {
        returnStatus = retStatus;
        setVisible(false);
        dispose();
    }

    public javax.swing.ButtonGroup buttonGroup1;

    public javax.swing.JButton cancelButton;

    public javax.swing.JPanel jPanel1;

    public javax.swing.JRadioButton jRadioButton1;

    public javax.swing.JRadioButton jRadioButton2;

    public javax.swing.JRadioButton jRadioButton3;

    public javax.swing.JRadioButton jRadioButton4;

    public javax.swing.JRadioButton jRadioButton5;

    public javax.swing.JRadioButton jRadioButton6;

    public javax.swing.JRadioButton jRadioButton7;

    public javax.swing.JTabbedPane jTabbedPane1;

    public javax.swing.JButton okButton;

    private String[] preferences = { "nebula" };

    public static String[] preferencesList = { "skin" };

    private int returnStatus = RET_CANCEL;

    private MainFrame mainFrame;
}
