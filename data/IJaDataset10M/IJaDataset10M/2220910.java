package corpodatrecords;

import corpodatrecordsbackend.City;
import corpodatrecordsbackend.CityJpaController;
import corpodatrecordsbackend.Client;
import corpodatrecordsbackend.ClientsDB;
import corpodatrecordsbackend.Delegation;
import corpodatrecordsbackend.DelegationJpaController;
import corpodatrecordsbackend.LegalPerson;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Date;
import java.util.Vector;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.UIManager;
import javax.swing.UnsupportedLookAndFeelException;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author luis
 */
public class ClientView extends javax.swing.JPanel {

    ClientsDB cdb;

    DelegationJpaController djc;

    CityJpaController cjc;

    ArrayList<City> lcs;

    Vector<String> cities;

    Vector<String> provinces;

    Vector<Integer> postalCodes;

    Vector<String> delegations;

    public ClientView(CityJpaController cjc) {
    }

    /** Creates new form ClientView */
    public ClientView() {
        try {
            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
            System.out.println("Look and feel stablished: " + UIManager.getSystemLookAndFeelClassName());
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(ClientView.class.getName()).log(Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            Logger.getLogger(ClientView.class.getName()).log(Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            Logger.getLogger(ClientView.class.getName()).log(Level.SEVERE, null, ex);
        } catch (UnsupportedLookAndFeelException ex) {
            Logger.getLogger(ClientView.class.getName()).log(Level.SEVERE, null, ex);
        }
        initComponents();
        this.djc = new DelegationJpaController();
        this.cdb = new ClientsDB();
        this.fillClients();
    }

    public void fillDelegations() {
        ArrayList<Delegation> ld = new ArrayList<Delegation>();
        ld = (ArrayList<Delegation>) this.djc.findDelegationEntities();
        for (Delegation d : ld) {
            this.delegations.add(d.getName());
            this.jComboBox_delegation.addItem(d.getName());
        }
    }

    public void fillCities(CityJpaController cjc) {
        this.cities = new Vector<String>();
        this.provinces = new Vector<String>();
        this.postalCodes = new Vector<Integer>();
        this.lcs = new ArrayList<City>(cjc.findCityEntities());
        System.out.print("Placing info internally from database... ");
        for (City c : lcs) {
            if (!this.cities.contains(c.getName())) {
                this.cities.add(c.getName());
            }
            if (!this.provinces.contains(c.getProvince())) this.provinces.add(c.getProvince());
            if (!this.postalCodes.contains(c.getPostalCode())) this.postalCodes.add(c.getPostalCode());
        }
        System.out.println("DONE.");
        System.out.print("Filling cities... ");
        Collections.sort(this.cities);
        for (String s : this.cities) {
            this.jComboBox_city.addItem(s);
        }
        System.out.println("DONE.");
        System.out.print("Filling provinces... ");
        Collections.sort(this.provinces);
        for (String s : this.provinces) {
            this.jComboBox_province.addItem(s);
        }
        System.out.println("DONE.");
        System.out.print("Filling postal codes... ");
        Collections.sort(this.postalCodes);
        for (Integer i : this.postalCodes) {
            this.jComboBox_postalCode.addItem(i);
        }
        System.out.println("DONE.");
    }

    public void fillClients() {
        System.out.println("Filling clients table...");
        ArrayList<Client> lc = this.cdb.getClients();
        if (!lc.isEmpty()) {
            for (Client c : lc) {
                this.addClientToColumm(c);
            }
        }
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    private void initComponents() {
        bindingGroup = new org.jdesktop.beansbinding.BindingGroup();
        CorpodatRecordsPUEntityManager = java.beans.Beans.isDesignTime() ? null : javax.persistence.Persistence.createEntityManagerFactory("CorpodatRecordsPU").createEntityManager();
        delegationQuery = java.beans.Beans.isDesignTime() ? null : CorpodatRecordsPUEntityManager.createQuery("SELECT d FROM Delegation d");
        delegationList = java.beans.Beans.isDesignTime() ? java.util.Collections.emptyList() : delegationQuery.getResultList();
        collectivesQuery = java.beans.Beans.isDesignTime() ? null : CorpodatRecordsPUEntityManager.createQuery("SELECT c FROM Collectives c");
        collectivesList = java.beans.Beans.isDesignTime() ? java.util.Collections.emptyList() : collectivesQuery.getResultList();
        cityQuery = java.beans.Beans.isDesignTime() ? null : CorpodatRecordsPUEntityManager.createQuery("SELECT c FROM City c");
        cityList = java.beans.Beans.isDesignTime() ? java.util.Collections.emptyList() : cityQuery.getResultList();
        delegationQuery1 = java.beans.Beans.isDesignTime() ? null : CorpodatRecordsPUEntityManager.createQuery("SELECT d FROM Delegation d");
        delegationList1 = java.beans.Beans.isDesignTime() ? java.util.Collections.emptyList() : delegationQuery1.getResultList();
        jScrollPane_data = new javax.swing.JScrollPane();
        jTable_data = new javax.swing.JTable();
        jSeparator1 = new javax.swing.JSeparator();
        jLabel1 = new javax.swing.JLabel();
        jTextField_CIF = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        jTextField_name = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jComboBox_delegation = new javax.swing.JComboBox();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jComboBox_city = new javax.swing.JComboBox();
        jLabel6 = new javax.swing.JLabel();
        jComboBox_province = new javax.swing.JComboBox();
        jLabel7 = new javax.swing.JLabel();
        jComboBox_postalCode = new javax.swing.JComboBox();
        jButton_refresh = new javax.swing.JButton();
        jButton_delete = new javax.swing.JButton();
        jButton_save = new javax.swing.JButton();
        jSeparator2 = new javax.swing.JSeparator();
        jSeparator3 = new javax.swing.JSeparator();
        jTextField_address = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        jTextField_tlfno_fijo = new javax.swing.JTextField();
        jLabel9 = new javax.swing.JLabel();
        jTextField_tlfno_movil = new javax.swing.JTextField();
        jLabel10 = new javax.swing.JLabel();
        jTextField_fax = new javax.swing.JTextField();
        jLabel11 = new javax.swing.JLabel();
        jTextField_email = new javax.swing.JTextField();
        jLabel12 = new javax.swing.JLabel();
        jTextField_cnae = new javax.swing.JTextField();
        jLabel13 = new javax.swing.JLabel();
        jTextField_ccotiza = new javax.swing.JTextField();
        jLabel14 = new javax.swing.JLabel();
        jComboBox_colective = new javax.swing.JComboBox();
        jCheckBox_rlt = new javax.swing.JCheckBox();
        jCheckBox_pyme = new javax.swing.JCheckBox();
        jCheckBox_new = new javax.swing.JCheckBox();
        jLabel15 = new javax.swing.JLabel();
        jLabel16 = new javax.swing.JLabel();
        jLabel17 = new javax.swing.JLabel();
        jTextField_legal_surname = new javax.swing.JTextField();
        jLabel18 = new javax.swing.JLabel();
        jTextField_legal_name = new javax.swing.JTextField();
        jLabel19 = new javax.swing.JLabel();
        jTextField_legal_dni = new javax.swing.JTextField();
        jLabel20 = new javax.swing.JLabel();
        jTextField_legal_tlfno = new javax.swing.JTextField();
        jButton_clean = new javax.swing.JButton();
        jLabel_creation_date = new javax.swing.JLabel();
        jFormattedTextField_creation_date = new javax.swing.JFormattedTextField();
        setName("Form");
        jScrollPane_data.setName("jScrollPane_data");
        jTable_data.setModel(new javax.swing.table.DefaultTableModel(new Object[][] {}, new String[] { "NIF/CIF", "Delegación", "Razón Social", "Domicilio", "Población", "Provincia", "C.Postal", "Tlfno.Fijo", "Tlfno.Móvil", "Fax", "E-Mail", "Cta.Cotización", "Conv.Colectivo", "R.I.T", "Pyme", "Nueva Creación", "Fecha de Creación", "C.N.A.E" }) {

            Class[] types = new Class[] { java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.Boolean.class, java.lang.Boolean.class, java.lang.Boolean.class, java.lang.Object.class, java.lang.String.class };

            public Class getColumnClass(int columnIndex) {
                return types[columnIndex];
            }
        });
        jTable_data.setName("jTable_data");
        jTable_data.addMouseListener(new java.awt.event.MouseAdapter() {

            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable_dataMouseClicked(evt);
            }
        });
        jTable_data.addMouseMotionListener(new java.awt.event.MouseMotionAdapter() {

            public void mouseDragged(java.awt.event.MouseEvent evt) {
                jTable_dataMouseDragged(evt);
            }
        });
        jTable_data.addPropertyChangeListener(new java.beans.PropertyChangeListener() {

            public void propertyChange(java.beans.PropertyChangeEvent evt) {
                jTable_dataPropertyChange(evt);
            }
        });
        jScrollPane_data.setViewportView(jTable_data);
        jSeparator1.setName("jSeparator1");
        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(corpodatrecords.CorpodatRecordsApp.class).getContext().getResourceMap(ClientView.class);
        jLabel1.setText(resourceMap.getString("jLabel1.text"));
        jLabel1.setName("jLabel1");
        jTextField_CIF.setName("jTextField_CIF");
        jTextField_CIF.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_CIFActionPerformed(evt);
            }
        });
        jLabel2.setText(resourceMap.getString("jLabel2.text"));
        jLabel2.setName("jLabel2");
        jTextField_name.setText(resourceMap.getString("jTextField_name.text"));
        jTextField_name.setName("jTextField_name");
        jLabel3.setText(resourceMap.getString("jLabel3.text"));
        jLabel3.setName("jLabel3");
        jComboBox_delegation.setEditable(true);
        jComboBox_delegation.setName("jComboBox_delegation");
        org.jdesktop.swingbinding.JComboBoxBinding jComboBoxBinding = org.jdesktop.swingbinding.SwingBindings.createJComboBoxBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, delegationList1, jComboBox_delegation);
        bindingGroup.addBinding(jComboBoxBinding);
        jLabel4.setText(resourceMap.getString("jLabel4.text"));
        jLabel4.setName("jLabel4");
        jLabel5.setText(resourceMap.getString("jLabel5.text"));
        jLabel5.setName("jLabel5");
        jComboBox_city.setEditable(true);
        jComboBox_city.setName("jComboBox_city");
        jComboBox_city.addItemListener(new java.awt.event.ItemListener() {

            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                jComboBox_cityItemStateChanged(evt);
            }
        });
        jLabel6.setText(resourceMap.getString("jLabel6.text"));
        jLabel6.setName("jLabel6");
        jComboBox_province.setEditable(true);
        jComboBox_province.setName("jComboBox_province");
        jComboBox_province.addFocusListener(new java.awt.event.FocusAdapter() {

            public void focusGained(java.awt.event.FocusEvent evt) {
                jComboBox_provinceFocusGained(evt);
            }
        });
        jLabel7.setText(resourceMap.getString("jLabel7.text"));
        jLabel7.setName("jLabel7");
        jComboBox_postalCode.setEditable(true);
        jComboBox_postalCode.setName("jComboBox_postalCode");
        jButton_refresh.setText(resourceMap.getString("jButton_refresh.text"));
        jButton_refresh.setName("jButton_refresh");
        jButton_refresh.addMouseListener(new java.awt.event.MouseAdapter() {

            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton_refreshMouseClicked(evt);
            }
        });
        jButton_delete.setText(resourceMap.getString("jButton_delete.text"));
        jButton_delete.setName("jButton_delete");
        jButton_delete.addMouseListener(new java.awt.event.MouseAdapter() {

            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton_deleteMouseClicked(evt);
            }
        });
        jButton_save.setText(resourceMap.getString("jButton_save.text"));
        jButton_save.setName("jButton_save");
        jButton_save.addMouseListener(new java.awt.event.MouseAdapter() {

            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton_saveMouseClicked(evt);
            }
        });
        jSeparator2.setName("jSeparator2");
        jSeparator3.setName("jSeparator3");
        jTextField_address.setText(resourceMap.getString("jTextField_address.text"));
        jTextField_address.setName("jTextField_address");
        jLabel8.setText(resourceMap.getString("jLabel8.text"));
        jLabel8.setName("jLabel8");
        jTextField_tlfno_fijo.setText(resourceMap.getString("jTextField_tlfno_fijo.text"));
        jTextField_tlfno_fijo.setName("jTextField_tlfno_fijo");
        jLabel9.setText(resourceMap.getString("jLabel9.text"));
        jLabel9.setName("jLabel9");
        jTextField_tlfno_movil.setText(resourceMap.getString("jTextField_tlfno_movil.text"));
        jTextField_tlfno_movil.setName("jTextField_tlfno_movil");
        jLabel10.setText(resourceMap.getString("jLabel10.text"));
        jLabel10.setName("jLabel10");
        jTextField_fax.setText(resourceMap.getString("jTextField_fax.text"));
        jTextField_fax.setName("jTextField_fax");
        jLabel11.setText(resourceMap.getString("jLabel11.text"));
        jLabel11.setName("jLabel11");
        jTextField_email.setText(resourceMap.getString("jTextField_email.text"));
        jTextField_email.setName("jTextField_email");
        jLabel12.setText(resourceMap.getString("jLabel12.text"));
        jLabel12.setToolTipText(resourceMap.getString("jLabel12.toolTipText"));
        jLabel12.setName("jLabel12");
        jTextField_cnae.setText(resourceMap.getString("jTextField_cnae.text"));
        jTextField_cnae.setToolTipText(resourceMap.getString("jTextField_cnae.toolTipText"));
        jTextField_cnae.setName("jTextField_cnae");
        jLabel13.setText(resourceMap.getString("jLabel13.text"));
        jLabel13.setName("jLabel13");
        jTextField_ccotiza.setText(resourceMap.getString("jTextField_ccotiza.text"));
        jTextField_ccotiza.setName("jTextField_ccotiza");
        jLabel14.setText(resourceMap.getString("jLabel14.text"));
        jLabel14.setName("jLabel14");
        jComboBox_colective.setEditable(true);
        jComboBox_colective.setName("jComboBox_colective");
        jComboBoxBinding = org.jdesktop.swingbinding.SwingBindings.createJComboBoxBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, collectivesList, jComboBox_colective);
        bindingGroup.addBinding(jComboBoxBinding);
        jCheckBox_rlt.setText(resourceMap.getString("jCheckBox_rlt.text"));
        jCheckBox_rlt.setToolTipText(resourceMap.getString("jCheckBox_rlt.toolTipText"));
        jCheckBox_rlt.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);
        jCheckBox_rlt.setName("jCheckBox_rlt");
        jCheckBox_pyme.setText(resourceMap.getString("jCheckBox_pyme.text"));
        jCheckBox_pyme.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);
        jCheckBox_pyme.setName("jCheckBox_pyme");
        jCheckBox_new.setText(resourceMap.getString("jCheckBox_new.text"));
        jCheckBox_new.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);
        jCheckBox_new.setName("jCheckBox_new");
        jCheckBox_new.addChangeListener(new javax.swing.event.ChangeListener() {

            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                jCheckBox_newStateChanged(evt);
            }
        });
        jLabel15.setFont(resourceMap.getFont("jLabel15.font"));
        jLabel15.setText(resourceMap.getString("jLabel15.text"));
        jLabel15.setName("jLabel15");
        jLabel16.setFont(resourceMap.getFont("jLabel16.font"));
        jLabel16.setText(resourceMap.getString("jLabel16.text"));
        jLabel16.setName("jLabel16");
        jLabel17.setText(resourceMap.getString("jLabel17.text"));
        jLabel17.setName("jLabel17");
        jTextField_legal_surname.setText(resourceMap.getString("jTextField_legal_surname.text"));
        jTextField_legal_surname.setName("jTextField_legal_surname");
        jLabel18.setText(resourceMap.getString("jLabel18.text"));
        jLabel18.setName("jLabel18");
        jTextField_legal_name.setText(resourceMap.getString("jTextField_legal_name.text"));
        jTextField_legal_name.setName("jTextField_legal_name");
        jLabel19.setText(resourceMap.getString("jLabel19.text"));
        jLabel19.setName("jLabel19");
        jTextField_legal_dni.setText(resourceMap.getString("jTextField_legal_dni.text"));
        jTextField_legal_dni.setName("jTextField_legal_dni");
        jLabel20.setText(resourceMap.getString("jLabel20.text"));
        jLabel20.setName("jLabel20");
        jTextField_legal_tlfno.setText(resourceMap.getString("jTextField_legal_tlfno.text"));
        jTextField_legal_tlfno.setName("jTextField_legal_tlfno");
        jButton_clean.setText(resourceMap.getString("jButton_clean.text"));
        jButton_clean.setName("jButton_clean");
        jButton_clean.addMouseListener(new java.awt.event.MouseAdapter() {

            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton_cleanMouseClicked(evt);
            }
        });
        jLabel_creation_date.setText(resourceMap.getString("jLabel_creation_date.text"));
        jLabel_creation_date.setEnabled(false);
        jLabel_creation_date.setName("jLabel_creation_date");
        jFormattedTextField_creation_date.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.DateFormatter(java.text.DateFormat.getDateInstance(java.text.DateFormat.SHORT))));
        jFormattedTextField_creation_date.setText(resourceMap.getString("jFormattedTextField_creation_date.text"));
        jFormattedTextField_creation_date.setEnabled(false);
        jFormattedTextField_creation_date.setName("jFormattedTextField_creation_date");
        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(jSeparator2, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 1574, Short.MAX_VALUE).addGroup(layout.createSequentialGroup().addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING).addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup().addComponent(jLabel17).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_legal_surname, javax.swing.GroupLayout.PREFERRED_SIZE, 223, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel18).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_legal_name, javax.swing.GroupLayout.PREFERRED_SIZE, 164, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel19).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_legal_dni, javax.swing.GroupLayout.PREFERRED_SIZE, 125, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel20).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_legal_tlfno, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE)).addComponent(jLabel16, javax.swing.GroupLayout.Alignment.LEADING)).addContainerGap()).addGroup(layout.createSequentialGroup().addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(layout.createSequentialGroup().addComponent(jLabel1).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_CIF, javax.swing.GroupLayout.PREFERRED_SIZE, 113, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel3).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jComboBox_delegation, javax.swing.GroupLayout.PREFERRED_SIZE, 164, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel2).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_name, javax.swing.GroupLayout.PREFERRED_SIZE, 296, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel12).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_cnae, javax.swing.GroupLayout.PREFERRED_SIZE, 84, javax.swing.GroupLayout.PREFERRED_SIZE)).addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup().addComponent(jLabel4).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_address, javax.swing.GroupLayout.DEFAULT_SIZE, 401, Short.MAX_VALUE).addGap(157, 157, 157).addComponent(jLabel5).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jComboBox_city, 0, 445, Short.MAX_VALUE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel6).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jComboBox_province, javax.swing.GroupLayout.PREFERRED_SIZE, 137, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel7).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jComboBox_postalCode, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)).addGroup(layout.createSequentialGroup().addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(layout.createSequentialGroup().addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false).addGroup(layout.createSequentialGroup().addComponent(jLabel8).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_tlfno_fijo, javax.swing.GroupLayout.PREFERRED_SIZE, 135, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel9).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_tlfno_movil, javax.swing.GroupLayout.PREFERRED_SIZE, 136, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel10).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_fax, javax.swing.GroupLayout.PREFERRED_SIZE, 150, javax.swing.GroupLayout.PREFERRED_SIZE)).addGroup(layout.createSequentialGroup().addGap(295, 295, 295).addComponent(jLabel14).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jComboBox_colective, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(layout.createSequentialGroup().addComponent(jLabel11).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_email, javax.swing.GroupLayout.PREFERRED_SIZE, 189, javax.swing.GroupLayout.PREFERRED_SIZE)).addGroup(layout.createSequentialGroup().addComponent(jCheckBox_rlt).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED).addComponent(jCheckBox_pyme).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED).addComponent(jCheckBox_new)))).addGroup(layout.createSequentialGroup().addComponent(jLabel13).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jTextField_ccotiza, javax.swing.GroupLayout.PREFERRED_SIZE, 148, javax.swing.GroupLayout.PREFERRED_SIZE))).addGap(18, 18, 18).addComponent(jLabel_creation_date).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jFormattedTextField_creation_date, javax.swing.GroupLayout.PREFERRED_SIZE, 92, javax.swing.GroupLayout.PREFERRED_SIZE))).addContainerGap()).addGroup(layout.createSequentialGroup().addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(jSeparator1, javax.swing.GroupLayout.DEFAULT_SIZE, 1562, Short.MAX_VALUE).addComponent(jLabel15)).addContainerGap()).addComponent(jSeparator3, javax.swing.GroupLayout.DEFAULT_SIZE, 1574, Short.MAX_VALUE).addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup().addContainerGap().addComponent(jButton_save).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jButton_delete).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jButton_refresh).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jButton_clean)).addGroup(layout.createSequentialGroup().addComponent(jScrollPane_data, javax.swing.GroupLayout.DEFAULT_SIZE, 1562, Short.MAX_VALUE).addContainerGap()));
        layout.setVerticalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup().addComponent(jScrollPane_data, javax.swing.GroupLayout.DEFAULT_SIZE, 404, Short.MAX_VALUE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel15).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED).addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jLabel1).addComponent(jTextField_CIF, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel3).addComponent(jComboBox_delegation, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel2).addComponent(jTextField_name, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel12).addComponent(jTextField_cnae, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jTextField_address, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel4).addComponent(jLabel5).addComponent(jComboBox_city, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jComboBox_province, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel6).addComponent(jLabel7).addComponent(jComboBox_postalCode, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)).addGap(6, 6, 6).addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jLabel8).addComponent(jTextField_tlfno_fijo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel9).addComponent(jTextField_tlfno_movil, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel10).addComponent(jTextField_fax, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel11).addComponent(jTextField_email, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jLabel13).addComponent(jTextField_ccotiza, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel14).addComponent(jComboBox_colective, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jCheckBox_rlt).addComponent(jCheckBox_pyme).addComponent(jCheckBox_new).addComponent(jLabel_creation_date).addComponent(jFormattedTextField_creation_date, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jSeparator3, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jLabel16).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED).addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jLabel17).addComponent(jTextField_legal_surname, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel18).addComponent(jTextField_legal_name, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel19).addComponent(jTextField_legal_dni, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel20).addComponent(jTextField_legal_tlfno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jButton_clean).addComponent(jButton_refresh).addComponent(jButton_delete).addComponent(jButton_save))));
        bindingGroup.bind();
    }

    private void jTextField_CIFActionPerformed(java.awt.event.ActionEvent evt) {
    }

    private void jButton_saveMouseClicked(java.awt.event.MouseEvent evt) {
        Client c = new Client();
        c.setAddress(this.jTextField_address.getText());
        c.setCif(this.jTextField_CIF.getText());
        c.setName(this.jTextField_name.getText());
        c.setCnae(this.jTextField_cnae.getText());
        c.setTlfno1(this.jTextField_tlfno_fijo.getText());
        c.setTlfno2(this.jTextField_tlfno_movil.getText());
        c.setFax(this.jTextField_fax.getText());
        c.setEmail(this.jTextField_email.getText());
        c.setCotAccount(this.jTextField_ccotiza.getText());
        c.setRit(this.jCheckBox_rlt.isSelected());
        c.setPyme(this.jCheckBox_pyme.isSelected());
        c.setNewCreation(this.jCheckBox_new.isSelected());
        c.setDelegationId(this.djc.findDelegation(this.jComboBox_delegation.getSelectedItem().toString()).getId());
        c.setCollectiveConv(this.jComboBox_colective.getSelectedItem().toString());
        if (c.getNewCreation()) c.setCreationDate((Date) this.jFormattedTextField_creation_date.getValue());
        LegalPerson lp = new LegalPerson();
        lp.setDni(this.jTextField_legal_dni.getText());
        lp.setName(this.jTextField_legal_name.getText());
        lp.setSurname(this.jTextField_legal_surname.getText());
        lp.setTlfno(this.jTextField_legal_tlfno.getText());
        if (!this.cdb.existsClient(c.getCif())) {
            System.out.println(">>> No existe, se añade!");
            cdb.addClient(c, lp);
            this.addClientToColumm(c);
            this.cleanClientData();
        } else {
            System.out.println(">>> Ya existe, se actualiza! (borra + crea)");
            this.cdb.rmClient(c.getCif());
            cdb.addClient(c, lp);
            this.addClientToColumm(c);
            this.cleanClientData();
        }
    }

    private void addClientToColumm(Client client) {
        DefaultTableModel tm = (DefaultTableModel) this.jTable_data.getModel();
        Vector v = new Vector();
        v.add(client.getCif());
        Delegation delAux = this.cdb.findDelegation(client.getDelegationId());
        if (!delAux.getName().equals(null)) {
            v.add(delAux.getName());
        } else {
            v.add("");
        }
        v.add(client.getName());
        v.add(client.getAddress());
        City c = this.cdb.findCity(client.getCityId());
        System.out.println("Ciudad... [" + c.getName() + "," + c.getProvince() + "," + c.getPostalCode() + "]");
        v.add(c.getName());
        v.add(c.getProvince());
        v.add(c.getPostalCode());
        v.add(client.getTlfno1());
        v.add(client.getTlfno2());
        v.add(client.getFax());
        v.add(client.getEmail());
        v.add(client.getCotAccount());
        v.add(client.getCollectiveConv());
        v.add(client.getRit());
        v.add(client.getPyme());
        v.add(client.getNewCreation());
        v.add(client.getCreationDate());
        v.add(client.getCnae());
        tm.addRow(v);
    }

    private void jButton_refreshMouseClicked(java.awt.event.MouseEvent evt) {
        System.out.println("Limpiando tabla... [1," + this.jTable_data.getRowCount());
        this.jTable_data.removeRowSelectionInterval(1, this.jTable_data.getRowCount());
    }

    private void jButton_deleteMouseClicked(java.awt.event.MouseEvent evt) {
        int n = JOptionPane.showConfirmDialog(this, "¿Seguro que desea eliminar éste cliente?", "Borrar Cliente", JOptionPane.YES_NO_OPTION);
        if (n == JOptionPane.YES_OPTION) {
            this.cdb.rmClient(this.jTextField_CIF.getText());
        }
    }

    private void cleanClientData() {
        this.jTextField_CIF.setText("");
        this.jTextField_name.setText("");
        this.jTextField_cnae.setText("");
        this.jTextField_address.setText("");
        this.jTextField_tlfno_fijo.setText("");
        this.jTextField_tlfno_movil.setText("");
        this.jTextField_fax.setText("");
        this.jTextField_email.setText("");
        this.jTextField_ccotiza.setText("");
        this.jComboBox_delegation.setSelectedIndex(0);
        this.jComboBox_city.setSelectedIndex(0);
        this.jComboBox_province.setSelectedIndex(0);
        this.jComboBox_postalCode.setSelectedIndex(0);
        this.jCheckBox_new.setSelected(false);
        this.jCheckBox_rlt.setSelected(false);
        this.jCheckBox_pyme.setSelected(false);
        this.jTextField_legal_surname.setText("");
        this.jTextField_legal_name.setText("");
        this.jTextField_legal_dni.setText("");
        this.jTextField_legal_tlfno.setText("");
        this.jLabel_creation_date.setEnabled(false);
        this.jFormattedTextField_creation_date.setEnabled(false);
        this.jFormattedTextField_creation_date.setValue(new Date());
    }

    private void jButton_cleanMouseClicked(java.awt.event.MouseEvent evt) {
        this.cleanClientData();
    }

    private void jCheckBox_newStateChanged(javax.swing.event.ChangeEvent evt) {
        if (this.jCheckBox_new.isSelected()) {
            this.jLabel_creation_date.setEnabled(true);
            this.jFormattedTextField_creation_date.setEnabled(true);
            if (this.jFormattedTextField_creation_date.getValue() == null) {
                this.jFormattedTextField_creation_date.setValue(new Date());
            }
        } else {
            this.jLabel_creation_date.setEnabled(false);
            this.jFormattedTextField_creation_date.setEnabled(false);
        }
    }

    private void jComboBox_cityItemStateChanged(java.awt.event.ItemEvent evt) {
    }

    private void jComboBox_provinceFocusGained(java.awt.event.FocusEvent evt) {
    }

    private void jTable_dataMouseDragged(java.awt.event.MouseEvent evt) {
    }

    private void jTable_dataPropertyChange(java.beans.PropertyChangeEvent evt) {
    }

    @SuppressWarnings("static-access")
    private void jTable_dataMouseClicked(java.awt.event.MouseEvent evt) {
        int row = this.jTable_data.getSelectedRow();
        this.jTextField_CIF.setText((String) this.jTable_data.getValueAt(row, 0));
        this.jTextField_name.setText((String) this.jTable_data.getValueAt(row, 2));
        this.jTextField_address.setText((String) this.jTable_data.getValueAt(row, 3));
        this.jTextField_tlfno_fijo.setText((String) this.jTable_data.getValueAt(row, 7));
        this.jTextField_tlfno_movil.setText((String) this.jTable_data.getValueAt(row, 8));
        this.jTextField_fax.setText((String) this.jTable_data.getValueAt(row, 9));
        this.jTextField_email.setText((String) this.jTable_data.getValueAt(row, 10));
        this.jTextField_ccotiza.setText((String) this.jTable_data.getValueAt(row, 11));
        this.jTextField_cnae.setText((String) this.jTable_data.getValueAt(row, 17));
        this.jCheckBox_rlt.setSelected((Boolean) this.jTable_data.getValueAt(row, 13));
        this.jCheckBox_pyme.setSelected((Boolean) this.jTable_data.getValueAt(row, 14));
        this.jCheckBox_new.setSelected((Boolean) this.jTable_data.getValueAt(row, 15));
        if (this.jCheckBox_new.isSelected()) this.jFormattedTextField_creation_date.setValue(this.jTable_data.getValueAt(row, 16));
        Client aux = this.cdb.findClient(this.jTextField_CIF.getText());
        LegalPerson lpAux = this.cdb.findLegalPerson(aux.getLegalPersonId());
        if (lpAux != null) {
            this.jTextField_legal_dni.setText(lpAux.getDni());
            this.jTextField_legal_name.setText(lpAux.getName());
            this.jTextField_legal_surname.setText(lpAux.getSurname());
            this.jTextField_legal_tlfno.setText(lpAux.getTlfno());
        } else {
            this.jTextField_legal_dni.setText("");
            this.jTextField_legal_name.setText("");
            this.jTextField_legal_surname.setText("");
            this.jTextField_legal_tlfno.setText("");
        }
    }

    private javax.persistence.EntityManager CorpodatRecordsPUEntityManager;

    private java.util.List<corpodatrecordsbackend.City> cityList;

    private javax.persistence.Query cityQuery;

    private java.util.List<corpodatrecords.Collectives> collectivesList;

    private javax.persistence.Query collectivesQuery;

    private java.util.List<corpodatrecordsbackend.Delegation> delegationList;

    private java.util.List<corpodatrecordsbackend.Delegation> delegationList1;

    private javax.persistence.Query delegationQuery;

    private javax.persistence.Query delegationQuery1;

    private javax.swing.JButton jButton_clean;

    private javax.swing.JButton jButton_delete;

    private javax.swing.JButton jButton_refresh;

    private javax.swing.JButton jButton_save;

    private javax.swing.JCheckBox jCheckBox_new;

    private javax.swing.JCheckBox jCheckBox_pyme;

    private javax.swing.JCheckBox jCheckBox_rlt;

    private javax.swing.JComboBox jComboBox_city;

    private javax.swing.JComboBox jComboBox_colective;

    private javax.swing.JComboBox jComboBox_delegation;

    private javax.swing.JComboBox jComboBox_postalCode;

    private javax.swing.JComboBox jComboBox_province;

    private javax.swing.JFormattedTextField jFormattedTextField_creation_date;

    private javax.swing.JLabel jLabel1;

    private javax.swing.JLabel jLabel10;

    private javax.swing.JLabel jLabel11;

    private javax.swing.JLabel jLabel12;

    private javax.swing.JLabel jLabel13;

    private javax.swing.JLabel jLabel14;

    private javax.swing.JLabel jLabel15;

    private javax.swing.JLabel jLabel16;

    private javax.swing.JLabel jLabel17;

    private javax.swing.JLabel jLabel18;

    private javax.swing.JLabel jLabel19;

    private javax.swing.JLabel jLabel2;

    private javax.swing.JLabel jLabel20;

    private javax.swing.JLabel jLabel3;

    private javax.swing.JLabel jLabel4;

    private javax.swing.JLabel jLabel5;

    private javax.swing.JLabel jLabel6;

    private javax.swing.JLabel jLabel7;

    private javax.swing.JLabel jLabel8;

    private javax.swing.JLabel jLabel9;

    private javax.swing.JLabel jLabel_creation_date;

    private javax.swing.JScrollPane jScrollPane_data;

    private javax.swing.JSeparator jSeparator1;

    private javax.swing.JSeparator jSeparator2;

    private javax.swing.JSeparator jSeparator3;

    private javax.swing.JTable jTable_data;

    private javax.swing.JTextField jTextField_CIF;

    private javax.swing.JTextField jTextField_address;

    private javax.swing.JTextField jTextField_ccotiza;

    private javax.swing.JTextField jTextField_cnae;

    private javax.swing.JTextField jTextField_email;

    private javax.swing.JTextField jTextField_fax;

    private javax.swing.JTextField jTextField_legal_dni;

    private javax.swing.JTextField jTextField_legal_name;

    private javax.swing.JTextField jTextField_legal_surname;

    private javax.swing.JTextField jTextField_legal_tlfno;

    private javax.swing.JTextField jTextField_name;

    private javax.swing.JTextField jTextField_tlfno_fijo;

    private javax.swing.JTextField jTextField_tlfno_movil;

    private org.jdesktop.beansbinding.BindingGroup bindingGroup;
}
