package biz.wavelet.thickclient.gui;

import biz.wavelet.thickclient.data.db.CustAccountDAO;
import biz.wavelet.thickclient.data.db.ItemDAO;
import biz.wavelet.thickclient.gui.models.CustomerSearchModel;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.math.BigDecimal;
import java.util.ArrayList;
import javax.swing.ListSelectionModel;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import org.jdesktop.application.Action;
import thickclient.sync.CustAccountObject;
import thickclient.sync.ItemObject;
import thickclient.sync.SalesTransactionItemObject;

/**
 *
 * @author  seraph
 */
public class CustomerSearchSelect extends javax.swing.JDialog {

    /** Creates new form CustomerSearchSelect */
    public CustomerSearchSelect(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        customerSearchTable.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        ListSelectionModel listModel = customerSearchTable.getSelectionModel();
        listModel.addListSelectionListener(new ListSelectionListener() {

            public void valueChanged(ListSelectionEvent arg0) {
                int selectedRow = customerSearchTable.getSelectedRow();
                customerSelectedPkid = Integer.parseInt((String) customerSearchTable.getValueAt(selectedRow, 0));
                CustAccountDAO custData = new CustAccountDAO();
                ArrayList filter = new ArrayList();
                filter.add("pkid = " + customerSelectedPkid);
                ArrayList results = custData.selectObject(filter);
                customerSearchResult = (CustAccountObject) results.get(0);
                customerSelectedPkid = customerSearchResult.getPkid();
            }
        });
        searchTermField.addActionListener(new ActionListener() {

            public void actionPerformed(ActionEvent arg0) {
                performSearch();
            }
        });
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    private void initComponents() {
        jLabel1 = new javax.swing.JLabel();
        searchTermField = new javax.swing.JTextField();
        searchButton = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        customerSearchTable = new javax.swing.JTable();
        addItemButton = new javax.swing.JButton();
        cancelButton = new javax.swing.JButton();
        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setName("Form");
        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(biz.wavelet.thickclient.gui.TCApp.class).getContext().getResourceMap(CustomerSearchSelect.class);
        jLabel1.setText(resourceMap.getString("jLabel1.text"));
        jLabel1.setName("jLabel1");
        searchTermField.setFocusCycleRoot(true);
        searchTermField.setName("searchTermField");
        searchButton.setFont(searchButton.getFont());
        searchButton.setText(resourceMap.getString("searchButton.text"));
        searchButton.setName("searchButton");
        searchButton.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                searchButtonActionPerformed(evt);
            }
        });
        jScrollPane1.setName("jScrollPane1");
        jScrollPane1.addMouseListener(new java.awt.event.MouseAdapter() {

            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jScrollPane1MouseClicked(evt);
            }
        });
        customerSearchTable.setModel(new CustomerSearchModel());
        customerSearchTable.setName("customerSearchTable");
        customerSearchTable.addMouseListener(new java.awt.event.MouseAdapter() {

            public void mouseClicked(java.awt.event.MouseEvent evt) {
                customerSearchTableMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(customerSearchTable);
        javax.swing.ActionMap actionMap = org.jdesktop.application.Application.getInstance(biz.wavelet.thickclient.gui.TCApp.class).getContext().getActionMap(CustomerSearchSelect.class, this);
        addItemButton.setAction(actionMap.get("selectItem"));
        addItemButton.setText(resourceMap.getString("addItemButton.text"));
        addItemButton.setName("addItemButton");
        addItemButton.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addItemButtonActionPerformed(evt);
            }
        });
        cancelButton.setAction(actionMap.get("cancel"));
        cancelButton.setText(resourceMap.getString("cancelButton.text"));
        cancelButton.setName("cancelButton");
        cancelButton.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelButtonActionPerformed(evt);
            }
        });
        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(layout.createSequentialGroup().addContainerGap().addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 522, Short.MAX_VALUE).addGroup(layout.createSequentialGroup().addComponent(jLabel1).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(searchTermField, javax.swing.GroupLayout.PREFERRED_SIZE, 158, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(searchButton)).addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup().addComponent(cancelButton).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(addItemButton))).addContainerGap()));
        layout.setVerticalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(layout.createSequentialGroup().addContainerGap().addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(jLabel1).addComponent(searchTermField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(searchButton)).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 241, Short.MAX_VALUE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(addItemButton).addComponent(cancelButton)).addContainerGap()));
        pack();
    }

    @Action
    private void performSearch() {
        CustomerSearchModel model = (CustomerSearchModel) customerSearchTable.getModel();
        model.getResults(searchTermField.getText());
    }

    public int getSelectedCustAccountPkid() {
        return customerSelectedPkid;
    }

    public CustAccountObject getSelectedCustAccountObject() {
        return customerSearchResult;
    }

    private void searchButtonActionPerformed(java.awt.event.ActionEvent evt) {
        performSearch();
    }

    private void customerSearchTableMouseClicked(java.awt.event.MouseEvent evt) {
    }

    private void jScrollPane1MouseClicked(java.awt.event.MouseEvent evt) {
    }

    private void addItemButtonActionPerformed(java.awt.event.ActionEvent evt) {
        System.out.println("test: " + customerSelectedPkid);
        System.out.println("test: " + customerSearchResult.getPkid());
    }

    @Action
    public void selectItem() {
        this.setVisible(false);
    }

    private void cancelButtonActionPerformed(java.awt.event.ActionEvent evt) {
        customerSearchResult = null;
        this.dispose();
    }

    private javax.swing.JButton addItemButton;

    private javax.swing.JButton cancelButton;

    private javax.swing.JTable customerSearchTable;

    private javax.swing.JLabel jLabel1;

    private javax.swing.JScrollPane jScrollPane1;

    private javax.swing.JButton searchButton;

    private javax.swing.JTextField searchTermField;

    private CustAccountObject customerSearchResult;

    public int customerSelectedPkid;
}
