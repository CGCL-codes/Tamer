package net.sf.opennemesis.motor.interfaz;

import net.sf.opennemesis.motor.estructuras.Graficos.Graficos;
import net.sf.opennemesis.motor.estructuras.Personajes.Genero;
import net.sf.opennemesis.motor.estructuras.Personajes.Jugador;
import net.sf.opennemesis.motor.eventos.*;

/**
 *
 * @author fictog
 */
public class CreadorPersonajes extends javax.swing.JPanel {

    /** Creates new form CreadorPersonajes */
    public CreadorPersonajes(NemesisEvent no, ExcepcionNemesis ne, Graficos g) {
        this.no = no;
        this.g = g;
        this.ne = ne;
        aux = Genero.MASCULINO;
        initComponents();
        initIcons();
        crearPersonaje();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    private void initComponents() {
        panelAutor = new javax.swing.JPanel();
        logo = new javax.swing.JLabel();
        panelPrincipal = new javax.swing.JPanel();
        panelSexo = new javax.swing.JPanel();
        panelAvatar = new javax.swing.JPanel();
        labelAvatar = new javax.swing.JLabel();
        botonMasculino = new javax.swing.JRadioButton();
        botonFemenino = new javax.swing.JRadioButton();
        panelTitulo = new javax.swing.JPanel();
        titulo = new javax.swing.JLabel();
        labelNombre = new javax.swing.JLabel();
        textoNombre = new javax.swing.JTextField();
        botonReRoll = new javax.swing.JButton();
        labelFondoNombre = new javax.swing.JLabel();
        botonAceptar = new javax.swing.JButton();
        botonCancelar = new javax.swing.JButton();
        panelStats = new javax.swing.JPanel();
        resistencia = new javax.swing.JLabel();
        fortaleza = new javax.swing.JLabel();
        sabiduria = new javax.swing.JLabel();
        statResistencia = new javax.swing.JLabel();
        statFortaleza = new javax.swing.JLabel();
        statSabiduria = new javax.swing.JLabel();
        barraResistencia = new javax.swing.JProgressBar();
        barraSabiduria = new javax.swing.JProgressBar();
        barraFortaleza = new javax.swing.JProgressBar();
        labelImagenFondo = new javax.swing.JLabel();
        borde = new javax.swing.JLabel();
        setBackground(new java.awt.Color(1, 1, 1));
        setFocusable(false);
        setMinimumSize(new java.awt.Dimension(800, 577));
        setPreferredSize(new java.awt.Dimension(800, 577));
        setLayout(null);
        panelAutor.setBackground(new java.awt.Color(0, 0, 0));
        panelAutor.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED, new java.awt.Color(207, 207, 207), new java.awt.Color(185, 185, 185), new java.awt.Color(185, 185, 185), new java.awt.Color(162, 162, 162)));
        panelAutor.setForeground(new java.awt.Color(239, 216, 216));
        panelAutor.setLayout(null);
        logo.setFont(new java.awt.Font("DejaVu Sans", 1, 18));
        logo.setForeground(new java.awt.Color(230, 170, 54));
        logo.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        panelAutor.add(logo);
        logo.setBounds(10, 10, 440, 40);
        panelPrincipal.setLayout(null);
        panelSexo.setBackground(new java.awt.Color(254, 254, 254));
        panelSexo.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED, new java.awt.Color(170, 170, 170), new java.awt.Color(119, 119, 119), new java.awt.Color(78, 78, 78), new java.awt.Color(83, 83, 83)));
        panelSexo.setLayout(null);
        panelAvatar.setBackground(new java.awt.Color(1, 1, 1));
        panelAvatar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED, new java.awt.Color(166, 166, 166), new java.awt.Color(189, 189, 189), new java.awt.Color(62, 62, 62), new java.awt.Color(103, 103, 103)));
        labelAvatar.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        labelAvatar.setToolTipText("El sexo del personaje no afecta los atributos de este.");
        javax.swing.GroupLayout panelAvatarLayout = new javax.swing.GroupLayout(panelAvatar);
        panelAvatar.setLayout(panelAvatarLayout);
        panelAvatarLayout.setHorizontalGroup(panelAvatarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(labelAvatar, javax.swing.GroupLayout.DEFAULT_SIZE, 36, Short.MAX_VALUE));
        panelAvatarLayout.setVerticalGroup(panelAvatarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(labelAvatar, javax.swing.GroupLayout.DEFAULT_SIZE, 36, Short.MAX_VALUE));
        panelSexo.add(panelAvatar);
        panelAvatar.setBounds(20, 10, 40, 40);
        botonMasculino.setBackground(new java.awt.Color(254, 254, 254));
        botonMasculino.setFont(new java.awt.Font("DejaVu Sans", 1, 13));
        botonMasculino.setForeground(new java.awt.Color(1, 1, 1));
        botonMasculino.setSelected(true);
        botonMasculino.setText("Masculino");
        botonMasculino.setToolTipText("El sexo del personaje no afecta los atributos de este.");
        botonMasculino.setFocusable(false);
        botonMasculino.setRolloverEnabled(false);
        botonMasculino.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonMasculinoActionPerformed(evt);
            }
        });
        panelSexo.add(botonMasculino);
        botonMasculino.setBounds(90, 10, 113, 22);
        botonFemenino.setBackground(new java.awt.Color(254, 254, 254));
        botonFemenino.setFont(new java.awt.Font("DejaVu Sans", 1, 13));
        botonFemenino.setForeground(new java.awt.Color(1, 1, 1));
        botonFemenino.setText("Femenino");
        botonFemenino.setToolTipText("El sexo del personaje no afecta los atributos de este.");
        botonFemenino.setFocusable(false);
        botonFemenino.setRolloverEnabled(false);
        botonFemenino.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonFemeninoActionPerformed(evt);
            }
        });
        panelSexo.add(botonFemenino);
        botonFemenino.setBounds(90, 30, 110, 22);
        panelPrincipal.add(panelSexo);
        panelSexo.setBounds(110, 130, 220, 60);
        panelTitulo.setBackground(new java.awt.Color(148, 148, 148));
        panelTitulo.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        titulo.setFont(new java.awt.Font("DejaVu Sans", 1, 14));
        titulo.setForeground(new java.awt.Color(1, 1, 1));
        titulo.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        titulo.setText("Nuevo Personaje");
        javax.swing.GroupLayout panelTituloLayout = new javax.swing.GroupLayout(panelTitulo);
        panelTitulo.setLayout(panelTituloLayout);
        panelTituloLayout.setHorizontalGroup(panelTituloLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(panelTituloLayout.createSequentialGroup().addContainerGap().addComponent(titulo, javax.swing.GroupLayout.DEFAULT_SIZE, 228, Short.MAX_VALUE).addContainerGap()));
        panelTituloLayout.setVerticalGroup(panelTituloLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(javax.swing.GroupLayout.Alignment.TRAILING, panelTituloLayout.createSequentialGroup().addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE).addComponent(titulo).addContainerGap()));
        panelPrincipal.add(panelTitulo);
        panelTitulo.setBounds(90, 10, 256, 40);
        labelNombre.setFont(new java.awt.Font("DejaVu Sans", 1, 13));
        labelNombre.setForeground(new java.awt.Color(1, 1, 1));
        labelNombre.setText("   Nombre:");
        panelPrincipal.add(labelNombre);
        labelNombre.setBounds(0, 60, 80, 60);
        textoNombre.setText("Felipe Montecristo");
        panelPrincipal.add(textoNombre);
        textoNombre.setBounds(90, 80, 330, 25);
        botonReRoll.setText("Volver a generar.");
        botonReRoll.setFocusable(false);
        botonReRoll.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonReRollActionPerformed(evt);
            }
        });
        panelPrincipal.add(botonReRoll);
        botonReRoll.setBounds(140, 270, 160, 30);
        panelPrincipal.add(labelFondoNombre);
        labelFondoNombre.setBounds(0, 60, 440, 60);
        botonAceptar.setText("Aceptar");
        botonAceptar.setBorder(javax.swing.BorderFactory.createMatteBorder(4, 4, 4, 4, new java.awt.Color(0, 0, 0)));
        botonAceptar.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonAceptarActionPerformed(evt);
            }
        });
        panelPrincipal.add(botonAceptar);
        botonAceptar.setBounds(320, 310, 110, 30);
        botonCancelar.setText("Cancelar");
        botonCancelar.setFocusable(false);
        botonCancelar.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonCancelarActionPerformed(evt);
            }
        });
        panelPrincipal.add(botonCancelar);
        botonCancelar.setBounds(196, 310, 110, 30);
        panelStats.setBackground(new java.awt.Color(148, 148, 148));
        panelStats.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        panelStats.setLayout(null);
        resistencia.setFont(new java.awt.Font("DejaVu Sans", 1, 10));
        resistencia.setForeground(new java.awt.Color(1, 1, 1));
        resistencia.setText("Agilidad");
        resistencia.setToolTipText("Determina la cantidad maxima de la barra de salud.");
        panelStats.add(resistencia);
        resistencia.setBounds(30, 10, 70, 10);
        fortaleza.setFont(new java.awt.Font("DejaVu Sans", 1, 10));
        fortaleza.setForeground(new java.awt.Color(1, 1, 1));
        fortaleza.setText("Fortaleza");
        fortaleza.setToolTipText("Determina el daño inflingido con armas de cuerpo a cuerpo.");
        panelStats.add(fortaleza);
        fortaleza.setBounds(30, 20, 70, 20);
        sabiduria.setFont(new java.awt.Font("DejaVu Sans", 1, 10));
        sabiduria.setForeground(new java.awt.Color(1, 1, 1));
        sabiduria.setText("Sabiduría");
        sabiduria.setToolTipText("Determina la cantidad maxima de la barra de magia.");
        panelStats.add(sabiduria);
        sabiduria.setBounds(30, 40, 70, 10);
        statResistencia.setFont(new java.awt.Font("DejaVu Sans", 1, 10));
        statResistencia.setForeground(new java.awt.Color(1, 1, 1));
        statResistencia.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        statResistencia.setText("0");
        panelStats.add(statResistencia);
        statResistencia.setBounds(340, 10, 30, 10);
        statFortaleza.setFont(new java.awt.Font("DejaVu Sans", 1, 10));
        statFortaleza.setForeground(new java.awt.Color(1, 1, 1));
        statFortaleza.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        statFortaleza.setText("0");
        panelStats.add(statFortaleza);
        statFortaleza.setBounds(340, 20, 30, 20);
        statSabiduria.setFont(new java.awt.Font("DejaVu Sans", 1, 10));
        statSabiduria.setForeground(new java.awt.Color(1, 1, 1));
        statSabiduria.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        statSabiduria.setText("0");
        panelStats.add(statSabiduria);
        statSabiduria.setBounds(340, 40, 30, 12);
        barraResistencia.setMaximum(20);
        panelStats.add(barraResistencia);
        barraResistencia.setBounds(110, 10, 230, 10);
        barraSabiduria.setMaximum(20);
        panelStats.add(barraSabiduria);
        barraSabiduria.setBounds(110, 40, 230, 10);
        barraFortaleza.setMaximum(20);
        panelStats.add(barraFortaleza);
        barraFortaleza.setBounds(110, 20, 230, 20);
        panelPrincipal.add(panelStats);
        panelStats.setBounds(20, 200, 410, 60);
        panelPrincipal.add(labelImagenFondo);
        labelImagenFondo.setBounds(0, 0, 440, 350);
        panelAutor.add(panelPrincipal);
        panelPrincipal.setBounds(10, 50, 440, 350);
        borde.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(254, 254, 254)));
        panelAutor.add(borde);
        borde.setBounds(5, 5, 450, 400);
        add(panelAutor);
        panelAutor.setBounds(170, 60, 460, 410);
    }

    private void initIcons() {
        labelAvatar.setIcon(g.jugadorM);
        labelFondoNombre.setIcon(g.barraCP);
        labelImagenFondo.setIcon(g.fondoCP);
        logo.setIcon(g.logo);
    }

    private void botonMasculinoActionPerformed(java.awt.event.ActionEvent evt) {
        if (botonFemenino.isSelected()) {
            botonFemenino.setSelected(false);
        } else {
            botonMasculino.setSelected(true);
        }
        labelAvatar.setIcon(g.jugadorM);
        aux = Genero.MASCULINO;
    }

    private void botonFemeninoActionPerformed(java.awt.event.ActionEvent evt) {
        if (botonMasculino.isSelected()) {
            botonMasculino.setSelected(false);
        } else {
            botonFemenino.setSelected(true);
        }
        labelAvatar.setIcon(g.jugadorF);
        aux = Genero.FEMENINO;
    }

    private void botonReRollActionPerformed(java.awt.event.ActionEvent evt) {
        regenerarPersonaje();
        Object arg = "99";
        no.setChanged();
        no.notifyObservers(arg);
    }

    private void botonAceptarActionPerformed(java.awt.event.ActionEvent evt) {
        j.actualizarStats(textoNombre.getText(), aux, 20, 0, j.getResistencia(), j.getFortaleza(), j.getSabiduria());
        java.io.File f = new java.io.File(j.getNombre() + ".dude");
        javax.swing.JFileChooser jfc = new javax.swing.JFileChooser();
        jfc.setFileSelectionMode(javax.swing.JFileChooser.FILES_ONLY);
        jfc.setAcceptAllFileFilterUsed(false);
        jfc.setFileFilter(new javax.swing.filechooser.FileNameExtensionFilter("Archivo de personaje (*.dude)", "dude"));
        jfc.setSelectedFile(f);
        int poop = jfc.showSaveDialog(this);
        if (poop == javax.swing.JFileChooser.CANCEL_OPTION) {
        } else {
            f = jfc.getSelectedFile();
            if (f.exists()) {
                no.setChanged();
                no.notifyObservers("99");
                int existe = javax.swing.JOptionPane.showConfirmDialog(this, "¿Desea reemplazar el archivo seleccionado?", "Archivo existe.", javax.swing.JOptionPane.INFORMATION_MESSAGE);
                if (existe == javax.swing.JOptionPane.OK_OPTION) {
                    guardarJugador(f, j);
                } else {
                    no.setChanged();
                    no.notifyObservers("2");
                }
            } else {
                guardarJugador(f, j);
            }
        }
    }

    private void guardarJugador(java.io.File f, Jugador j) {
        try {
            java.io.FileOutputStream fos = new java.io.FileOutputStream(f);
            java.io.ObjectOutputStream oos = new java.io.ObjectOutputStream(fos);
            oos.writeObject(j);
            oos.flush();
            oos.close();
            fos.close();
            f.createNewFile();
            no.setChanged();
            no.notifyObservers("4");
        } catch (Exception e) {
            ne.setChanged();
            ne.notifyObservers(e.toString());
            no.setChanged();
            no.notifyObservers("2");
        }
    }

    private void botonCancelarActionPerformed(java.awt.event.ActionEvent evt) {
        Object arg = "2";
        no.setChanged();
        no.notifyObservers(arg);
    }

    private void crearPersonaje() {
        int[] stats = generarStats();
        j = Jugador.getInstance(textoNombre.getText(), aux, 20, 0, stats[0], stats[1], stats[2]);
        actualizarBarras(j);
    }

    public void regenerarPersonaje() {
        int[] stats = generarStats();
        j.actualizarStats(textoNombre.getText(), aux, 20, 0, stats[0], stats[1], stats[2]);
        actualizarBarras(j);
    }

    private int[] generarStats() {
        int[] stats = new int[3];
        stats[0] = (int) ((Math.random() * 17) + 3);
        stats[1] = (int) ((Math.random() * 17) + 3);
        stats[2] = (int) ((Math.random() * 17) + 3);
        for (int i = 0; i < 3; i++) {
            int x = (int) (Math.random() * 3);
            switch(i) {
                case 1:
                    stats[i] = stats[i] + x;
                    break;
                case 2:
                    stats[i] = stats[i] - x;
                    break;
                case 3:
                    stats[i] = (stats[i] + x) - (x - 1);
                    break;
                default:
                    break;
            }
            if (stats[i] >= 17) {
                stats[i] = 17;
            } else if (stats[i] <= 4) stats[i] = 4;
        }
        return stats;
    }

    private void actualizarBarras(Jugador j) {
        barraResistencia.setValue(j.getResistencia());
        statResistencia.setText(Integer.toString(j.getResistencia()));
        barraFortaleza.setValue(j.getFortaleza());
        statFortaleza.setText(Integer.toString(j.getFortaleza()));
        barraSabiduria.setValue(j.getSabiduria());
        statSabiduria.setText(Integer.toString(j.getSabiduria()));
    }

    public void ocultar() {
        this.remove(panelAutor);
        repaint();
    }

    private javax.swing.JProgressBar barraFortaleza;

    private javax.swing.JProgressBar barraResistencia;

    private javax.swing.JProgressBar barraSabiduria;

    private javax.swing.JLabel borde;

    private javax.swing.JButton botonAceptar;

    private javax.swing.JButton botonCancelar;

    private javax.swing.JRadioButton botonFemenino;

    private javax.swing.JRadioButton botonMasculino;

    private javax.swing.JButton botonReRoll;

    private javax.swing.JLabel fortaleza;

    private javax.swing.JLabel labelAvatar;

    private javax.swing.JLabel labelFondoNombre;

    private javax.swing.JLabel labelImagenFondo;

    private javax.swing.JLabel labelNombre;

    private javax.swing.JLabel logo;

    private javax.swing.JPanel panelAutor;

    private javax.swing.JPanel panelAvatar;

    private javax.swing.JPanel panelPrincipal;

    private javax.swing.JPanel panelSexo;

    private javax.swing.JPanel panelStats;

    private javax.swing.JPanel panelTitulo;

    private javax.swing.JLabel resistencia;

    private javax.swing.JLabel sabiduria;

    private javax.swing.JLabel statFortaleza;

    private javax.swing.JLabel statResistencia;

    private javax.swing.JLabel statSabiduria;

    private javax.swing.JTextField textoNombre;

    private javax.swing.JLabel titulo;

    private NemesisEvent no;

    private ExcepcionNemesis ne;

    public Jugador j;

    private Graficos g;

    private Genero aux;
}
