package com.catosist.run.application.cliente;

import com.catosist.run.application.Util.ButtonTabComponent;
import com.catosist.run.business.gestorcliente.GestorCliente;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import org.springframework.orm.hibernate3.HibernateObjectRetrievalFailureException;

/**
 *
 * @author igorov
 */
public class ManCliente extends javax.swing.JFrame {

    /** Creates new form ManCliente */
    public ManCliente() {
        initComponents();
    }

    public ManCliente(GestorCliente gestorCliente) {
        initComponents();
        this.gestorCliente = gestorCliente;
        gestionCliente = new GestionCliente(gestorCliente);
    }

    public JPanel getPanel() {
        return jPanel2;
    }

    public void agregaPestanha(JPanel panel, String titulo) {
        this.tabWork.add(titulo, panel);
        this.tabWork.setSelectedIndex(this.tabWork.getTabCount() - 1);
        ButtonTabComponent pestana = new ButtonTabComponent("", this.tabWork);
        this.tabWork.setTabComponentAt(this.tabWork.getTabCount() - 1, pestana);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    private void initComponents() {
        jPanel2 = new javax.swing.JPanel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        btnVer = new javax.swing.JButton();
        btnNuevo = new javax.swing.JButton();
        btnEditar = new javax.swing.JButton();
        btnEliminar = new javax.swing.JButton();
        tabWork = new javax.swing.JTabbedPane();
        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setName("Form");
        jPanel2.setName("jPanel2");
        jTabbedPane1.setName("jTabbedPane1");
        jPanel1.setName("jPanel1");
        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(com.catosist.run.application.desktopapplication.DesktopApplication.class).getContext().getResourceMap(ManCliente.class);
        btnVer.setText(resourceMap.getString("btnVer.text"));
        btnVer.setName("btnVer");
        btnVer.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnVerActionPerformed(evt);
            }
        });
        btnNuevo.setText(resourceMap.getString("btnNuevo.text"));
        btnNuevo.setName("btnNuevo");
        btnNuevo.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnNuevoActionPerformed(evt);
            }
        });
        btnEditar.setText(resourceMap.getString("btnEditar.text"));
        btnEditar.setName("btnEditar");
        btnEditar.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEditarActionPerformed(evt);
            }
        });
        btnEliminar.setText(resourceMap.getString("btnEliminar.text"));
        btnEliminar.setName("btnEliminar");
        btnEliminar.addActionListener(new java.awt.event.ActionListener() {

            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEliminarActionPerformed(evt);
            }
        });
        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(jPanel1Layout.createSequentialGroup().addContainerGap().addComponent(btnVer).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(btnNuevo).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED).addComponent(btnEditar).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(btnEliminar).addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)));
        jPanel1Layout.setVerticalGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(jPanel1Layout.createSequentialGroup().addContainerGap().addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE).addComponent(btnVer).addComponent(btnNuevo).addComponent(btnEditar).addComponent(btnEliminar)).addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)));
        jTabbedPane1.addTab(resourceMap.getString("jPanel1.TabConstraints.tabTitle"), jPanel1);
        tabWork.setName("tabWork");
        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(jPanel2Layout.createSequentialGroup().addContainerGap().addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addComponent(jTabbedPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 531, Short.MAX_VALUE).addComponent(tabWork, javax.swing.GroupLayout.DEFAULT_SIZE, 531, Short.MAX_VALUE)).addContainerGap()));
        jPanel2Layout.setVerticalGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(jPanel2Layout.createSequentialGroup().addContainerGap().addComponent(jTabbedPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE).addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED).addComponent(tabWork, javax.swing.GroupLayout.DEFAULT_SIZE, 229, Short.MAX_VALUE).addContainerGap()));
        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 555, Short.MAX_VALUE).addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE));
        layout.setVerticalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 329, Short.MAX_VALUE).addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE));
        pack();
    }

    private void btnVerActionPerformed(java.awt.event.ActionEvent evt) {
        agregaPestanha(gestionCliente.getPanel(), "Ver todos los clientes");
    }

    private void btnNuevoActionPerformed(java.awt.event.ActionEvent evt) {
        DialogCliente dialogCliente = new DialogCliente(this, true, gestorCliente, 0);
        dialogCliente.setLocationRelativeTo(this);
        dialogCliente.setVisible(true);
        this.gestionCliente.refresh();
    }

    private void btnEditarActionPerformed(java.awt.event.ActionEvent evt) {
        try {
            int i = this.gestionCliente.getSelectedId();
            DialogCliente dialogCliente = new DialogCliente(this, true, gestorCliente, i);
            dialogCliente.setLocationRelativeTo(this);
            dialogCliente.setVisible(true);
            gestionCliente.refresh();
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Debe seleccionar un cliente existente", "Advertencia", JOptionPane.WARNING_MESSAGE);
        }
    }

    private void btnEliminarActionPerformed(java.awt.event.ActionEvent evt) {
        try {
            int i = this.gestionCliente.getSelectedId();
            int result = JOptionPane.showConfirmDialog(this, "Realmente desea eliminar el registro?");
            if (result == JOptionPane.YES_OPTION) {
                gestorCliente.deleteById(i);
                gestionCliente.refresh();
            }
        } catch (ArrayIndexOutOfBoundsException e) {
            JOptionPane.showMessageDialog(this, "Debe seleccionar un cliente existente", "Advertencia", JOptionPane.WARNING_MESSAGE);
        } catch (HibernateObjectRetrievalFailureException e) {
            JOptionPane.showMessageDialog(this, "No se puede eliminar el cliente", "Advertencia", JOptionPane.WARNING_MESSAGE);
        }
    }

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {

            public void run() {
                new ManCliente().setVisible(true);
            }
        });
    }

    private javax.swing.JButton btnEditar;

    private javax.swing.JButton btnEliminar;

    private javax.swing.JButton btnNuevo;

    private javax.swing.JButton btnVer;

    private javax.swing.JPanel jPanel1;

    private javax.swing.JPanel jPanel2;

    private javax.swing.JTabbedPane jTabbedPane1;

    private javax.swing.JTabbedPane tabWork;

    GestorCliente gestorCliente;

    GestionCliente gestionCliente;
}
