    public void testCMT() throws Exception {
        getSessions().getStatistics().clear();
        SimpleJtaTransactionManagerImpl.getInstance().begin();
        Session s = openSession();
        SimpleJtaTransactionManagerImpl.getInstance().getTransaction().commit();
        assertFalse(s.isOpen());
        assertEquals(getSessions().getStatistics().getFlushCount(), 0);
        SimpleJtaTransactionManagerImpl.getInstance().begin();
        s = openSession();
        SimpleJtaTransactionManagerImpl.getInstance().getTransaction().rollback();
        assertFalse(s.isOpen());
        SimpleJtaTransactionManagerImpl.getInstance().begin();
        s = openSession();
        Map item = new HashMap();
        item.put("name", "The Item");
        item.put("description", "The only item we have");
        s.persist("Item", item);
        SimpleJtaTransactionManagerImpl.getInstance().getTransaction().commit();
        assertFalse(s.isOpen());
        SimpleJtaTransactionManagerImpl.getInstance().begin();
        s = openSession();
        item = (Map) s.createQuery("from Item").uniqueResult();
        assertNotNull(item);
        s.delete(item);
        SimpleJtaTransactionManagerImpl.getInstance().getTransaction().commit();
        assertFalse(s.isOpen());
        assertEquals(getSessions().getStatistics().getTransactionCount(), 4);
        assertEquals(getSessions().getStatistics().getSuccessfulTransactionCount(), 3);
        assertEquals(getSessions().getStatistics().getEntityDeleteCount(), 1);
        assertEquals(getSessions().getStatistics().getEntityInsertCount(), 1);
        assertEquals(getSessions().getStatistics().getSessionOpenCount(), 4);
        assertEquals(getSessions().getStatistics().getSessionCloseCount(), 4);
        assertEquals(getSessions().getStatistics().getQueryExecutionCount(), 1);
        assertEquals(getSessions().getStatistics().getFlushCount(), 2);
        SimpleJtaTransactionManagerImpl.getInstance().begin();
        s = openSession();
        s.createQuery("delete from Item").executeUpdate();
        SimpleJtaTransactionManagerImpl.getInstance().commit();
    }
