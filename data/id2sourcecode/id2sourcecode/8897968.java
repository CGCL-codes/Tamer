    private void buildKmzFile() throws ParserConfigurationException, TransformerFactoryConfigurationError, TransformerException, IOException {
        MapSpace mapSpace = mapSource.getMapSpace();
        NumberFormat df = Utilities.FORMAT_6_DEC_ENG;
        String longitudeMin = df.format(mapSpace.cXToLon(xMin * tileSize, zoom));
        String longitudeMax = df.format(mapSpace.cXToLon((xMax + 1) * tileSize, zoom));
        String latitudeMin = df.format(mapSpace.cYToLat((yMax + 1) * tileSize, zoom));
        String latitudeMax = df.format(mapSpace.cYToLat(yMin * tileSize, zoom));
        DocumentBuilder builder;
        builder = DocumentBuilderFactory.newInstance().newDocumentBuilder();
        Document doc = builder.newDocument();
        Element kml = doc.createElementNS("http://www.opengis.net/kml/2.2", "kml");
        Element go = doc.createElement("GroundOverlay");
        Element ico = doc.createElement("Icon");
        Element href = doc.createElement("href");
        Element drawOrder = doc.createElement("DrawOrder");
        Element latLonBox = doc.createElement("LatLonBox");
        Element north = doc.createElement("north");
        Element south = doc.createElement("south");
        Element east = doc.createElement("east");
        Element west = doc.createElement("west");
        Element rotation = doc.createElement("rotation");
        href.setTextContent(imageFileName);
        drawOrder.setTextContent("0");
        north.setTextContent(latitudeMax);
        south.setTextContent(latitudeMin);
        west.setTextContent(longitudeMin);
        east.setTextContent(longitudeMax);
        rotation.setTextContent("0.0");
        doc.appendChild(kml);
        kml.appendChild(go);
        go.appendChild(ico);
        go.appendChild(latLonBox);
        ico.appendChild(href);
        ico.appendChild(drawOrder);
        latLonBox.appendChild(north);
        latLonBox.appendChild(south);
        latLonBox.appendChild(east);
        latLonBox.appendChild(west);
        latLonBox.appendChild(rotation);
        Transformer serializer;
        serializer = TransformerFactory.newInstance().newTransformer();
        serializer.setOutputProperty(OutputKeys.INDENT, "yes");
        serializer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2");
        kmzOutputStream.putNextEntry(new ZipEntry("doc.kml"));
        serializer.transform(new DOMSource(doc), new StreamResult(kmzOutputStream));
        kmzOutputStream.closeEntry();
    }
